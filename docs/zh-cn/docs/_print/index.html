<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.121.2">
<link rel="canonical" type="text/html" href="/zh-cn/docs/">
<link rel="alternate" type="application/rss&#43;xml" href="/zh-cn/docs/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>文档 | Wiseinf</title>
<meta name="description" content="云原生成本管理和优化平台">
<meta property="og:title" content="文档" />
<meta property="og:description" content="云原生成本管理和优化平台" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/zh-cn/docs/" /><meta property="og:site_name" content="云智优本" />

<meta itemprop="name" content="文档">
<meta itemprop="description" content="云原生成本管理和优化平台"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="文档"/>
<meta name="twitter:description" content="云原生成本管理和优化平台"/>




<link rel="preload" href="/scss/main.min.b9f908f9939278827beae3d5d8ede093dde52fd2c4bcdf7ba620a3d524d46875.css" as="style">
<link href="/scss/main.min.b9f908f9939278827beae3d5d8ede093dde52fd2c4bcdf7ba620a3d524d46875.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-STB7S5D1BR"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-STB7S5D1BR');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class="navbar-brand" href="/zh-cn/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="90" height="60" viewBox="0 0 90 60" enable-background="new 0 0 90 60"><image id="image0" width="90" height="60" x="0" y="0" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAA8CAMAAADR2113AAAABGdBTUEAALGPC/xhBQAAACBjSFJN AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAUVBMVEUAAAA/R8s/ScwAoeci u1UisEwisEwzzGYhsUshsUwisUsAf38hsUshsEsisEwAqlUhsEwhsEshsU0isUoisUwA/wA/SMwA ougisUyZ2er///8l8mu7AAAAFnRSTlMAmUyZD4XZBWzxfQKoqKMDgutMd6EBrgesWwAAAAFiS0dE GnVn5DIAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAAHdElNRQfmCwIILDYpiAQqAAAAuElEQVRYw+3V yQ7CMAxFUQMZmpZOKQXz/z8KRYLSxrCAFwkJ322ks4jimGhqc5TaTke7kxTNGet4yllDQp/Tvgh8 L5QVkt7zczWO9kuZuWlRdMHrOhBtQkL3HkNbTrMY2gm0w9AsBaGjSMf/pTPedc4XkvFdZ5xGKhN6 QH1PVb2SDyOKJmqWMhGObrt+vudhRNLXdfDYjZ4IS9/mMkZ60bf0m5T+efospbTSSiuttNJKK620 0kpnoC8F20SzlPhKcAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMi0xMS0wMlQwODo0NDo1NCswMDow MEh3G+0AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjItMTEtMDJUMDg6NDQ6NTQrMDA6MDA5KqNRAAAA KHRFWHRkYXRlOnRpbWVzdGFtcAAyMDIyLTExLTAyVDA4OjQ0OjU0KzAwOjAwbj+CjgAAAABJRU5E rkJggg=="/></svg></span><span class="navbar-brand__name">Wiseinf</span></a>
<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
  <ul class="navbar-nav mt-2 mt-lg-0">
    <li class="nav-item dropdown mr-4 d-none d-lg-block">
      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
      aria-haspopup="true" aria-expanded="false"><span>产品</span></a>
      <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
        <a class="dropdown-item" href="/zh-cn/products/cluster-optimizer"> Cluster Optimizer：云原生集群优化平台 </a>
        <a class="dropdown-item" href="/zh-cn/products/wisecost"> Wisecost：云原生成本管理平台 </a>
        <a class="dropdown-item" href="/zh-cn/products/ruyi"> Ruyi：云原生集群扩缩容引擎</a>
      </div>
      </li>
      
      <li class="nav-item mr-4 mb-2 mb-lg-0">
      <a class="nav-link active" href="/zh-cn/docs/"><span class="active">文档</span></a>
      </li>
      
      <li class="nav-item mr-4 mb-2 mb-lg-0">
      <a class="nav-link" href="/zh-cn/pricing/"><span>价格</span></a>
      </li>
      
      <li class="nav-item mr-4 mb-2 mb-lg-0">
      <a class="nav-link" href="/zh-cn/services/"><span>服务</span></a>
      </li>
      <li class="nav-item dropdown mr-4 d-none d-lg-block">
      

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	中文
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/docs/">English</a>
	
</div></li>
    </ul>
</div>
<div class="navbar-nav d-none d-lg-block">
  
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/zh-cn/docs/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">文档</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-f5c816802ec0d033e8fcd3e337a29c96">Cluster Optimizer</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-319d547359ece75bc8828c67e98da1cf">安装</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.2: <a href="#pg-da59e19291384c4c46aa84925c92b66c">导入AWS EKS集群</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.3: <a href="#pg-ab611226a338ba3cf65a94042e8aa36a">导入阿里云集群</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.4: <a href="#pg-cbcde0fe6010529c37131204023b7771">集群概览</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.5: <a href="#pg-a8e419965395a39fb951fa1137e17781">节点池优化</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.6: <a href="#pg-60fb2e0d684559cca943f114bbb23b17">节点优化</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.7: <a href="#pg-41a35fffa4c7fd6466728b424aab2998">磁盘优化</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.8: <a href="#pg-ec4c2c1254809868f664e7266e289938">Persistent Volume优化</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.9: <a href="#pg-077e156274fb7d892f55e54292de72da">应用优化</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.10: <a href="#pg-ec768fe1731869c4e5952255d641c790">集群优化操作</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.10.1: <a href="#pg-b44e424da94f6990e4d02978cbc967a9">调整节点池</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.10.2: <a href="#pg-5db2c5107c2c5b867fd9b6b316f9f181">调整节点</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.10.3: <a href="#pg-25ff9c4e42700bf130854451e52d2fb1">调整磁盘</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.10.4: <a href="#pg-cf75811c0797e8dc5e66957ac96debfb">删除Persistent Volume</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-dacaf1e373c2472c1efbf2a9b2acf54b">Wisecost：云原生成本管理和优化平台</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-d1501d8c0fcaf4a0c0134a7c69ba635e">安装部署</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.2: <a href="#pg-f8724eef5ecfc709ba9ec953f1658ee2">导入阿里云集群</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.3: <a href="#pg-79c3c5401e75cd51b9d3c28865234518">查看集群成本</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.4: <a href="#pg-8aaf6cb4995450b6fc76e7ad887b0eb3">查看节点成本</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.5: <a href="#pg-aea197f3575cb0df1ded1df55290950c">查看应用成本</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.6: <a href="#pg-0d313d792f0ef08d3b1695b67d8bddea">成本优化</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.7: <a href="#pg-eb8dcf79b1b7f912ed56305be6f0297f">开发手册</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.7.1: <a href="#pg-7498afe225cc47a707df513f40a91ac6">API文档</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.7.2: <a href="#pg-ac38a1975f478ccb8a2806eda6f684b8">API接口参考</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-01e1381825635108c13ad0b6aeb191c7">Ruyi：云原生集群扩缩容引擎</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-cc7d60fb60c1ccaac59ce2ceb1c8f961">安装部署</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.2: <a href="#pg-802a1bd58ef9bdae22313856241b0f7f">自动扩缩容</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.3: <a href="#pg-9bc01fd7dcd71c629d9b0497e453387a">虚拟容量</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.4: <a href="#pg-1d9cdd8985d61af6eb19f64872c6238c">配置</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.4.1: <a href="#pg-311560d092771780a32c6c35dc00ad8c">节点组配置参数</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.4.2: <a href="#pg-743cd90d3c1ba1709b66bd0042c39a58">命令行参数</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>3.5: <a href="#pg-db1b774ac87b4e433a86ed299f8a808f">监控</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.6: <a href="#pg-583a7f09d0feaa261a5b4bd84a75d62a">常见问题</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  

    </ul>


<div class="content">
      

<div class="pageinfo pageinfo-primary">
<p>本部分包括公司提供的所有产品、服务和解决方案的相关文档。</p>

</div>


</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-f5c816802ec0d033e8fcd3e337a29c96">1 - Cluster Optimizer</h1>
    <div class="lead">云原生集群优化平台.</div>
	

<div class="pageinfo pageinfo-primary">
<p>云原生集群优化平台（Cluster Optimizer）提供了云原生云原生集群优化能力。</p>

</div>

<p>Cluster Optimizer能够帮助用户对云原生集群进行优化，主要功能包括：</p>
<ul>
<li>提供多种优化策略，包括节点组、节点、磁盘、Persistent和应用等多个维度的优化建议。</li>
<li>云账户（访问凭据）管理和集群管理。</li>
<li>用户管理（社区版不支持）。</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-319d547359ece75bc8828c67e98da1cf">1.1 - 安装</h1>
    <div class="lead">描述安装云原生集群优化平台（Cluster Optimizer）的详细步骤.</div>
	

<div class="pageinfo pageinfo-primary">
<p>本页面描述了安装一站式云原生集群优化平台（Cluster Optimizer）的详细步骤.</p>

</div>

<h2 id="前置条件">前置条件</h2>
<ul>
<li>Mysql数据库，版本5.7及以上</li>
<li>Kubernetes集群，版本1.22及以上</li>
<li>Kubernetes集群的证书，能够创建<code>wiseinf-system</code>名称空间以及在此名称空间下创建Deployment、ConfigMap、Service等资源</li>
</ul>
<h2 id="克隆安装脚本">克隆安装脚本</h2>
<ol>
<li>
<p>打开命令行控制台，通过下述命令将安装脚本克隆到本地。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    git clone https://github.com/wiseinf/setup.git
</span></span></code></pre></div><blockquote>
<p>1，若使用Gitee仓库地址，则需将上述命令中的<code>https://github.com/wiseinf/setup.git</code>替换为<code>https://gitee.com/wiseinf/setup.git</code>。</p>
<p>2，后续步骤假设已将<code>setup</code>库克隆到用户主目录，若未克隆到用户主目录，则需要根据实际情况调整命令中的文件路径。</p>
</blockquote>
</li>
</ol>
<h2 id="初始化数据库">初始化数据库</h2>
<blockquote>
<p>假设Mysql数据库主机地址为：<code>127.0.0.1</code>.</p>
</blockquote>
<ol>
<li>
<p>在命令行控制台执行如下命令登录到Mysql数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    mysql -h127.0.0.1 -uroot
</span></span></code></pre></div></li>
<li>
<p>通过如下命令创建<code>optimizer</code>库，同时，也创建用户<code>optimizer</code>（密码为<code>Optimizer~</code>）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    mysql&gt; source ~/setup/clusteroptimizer/sql/create_database.sql
</span></span><span style="display:flex;"><span>    mysql&gt; source ~/setup/clusteroptimizer/sql/create_user.sql
</span></span></code></pre></div><blockquote>
<p>注意：请关注数据丢失风险。若mysql数据库中已经存在<code>optimizer</code>库，则上述脚本会先删除<code>optimizer</code>库，然后创建新的<code>optimizer</code>库。</p>
</blockquote>
</li>
<li>
<p>通过如下命令检查<code>optimizer</code>库是否创建成功（当提示输入密码时，请输入<code>Optimizer~</code>）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    mysql -h127.0.0.1 -uoptimizer 
</span></span><span style="display:flex;"><span>    mysql&gt; show databases;
</span></span></code></pre></div></li>
<li>
<p>可通过创建表格<code>test</code>来确认用户<code>optimizer</code>权限是否正常，例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    mysql&gt; USE optimizer;
</span></span><span style="display:flex;"><span>    mysql&gt; CREATE TABLE test <span style="color:#f92672">(</span>id int<span style="color:#f92672">)</span>;
</span></span></code></pre></div></li>
<li>
<p>至此，数据库<code>optimizer</code>成功初始化完毕。</p>
</li>
</ol>
<h2 id="部署应用">部署应用</h2>
<ol>
<li>
<p>通过如下命令创建名称空间<code>wiseinf-system</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    kubectl apply -f ~/setup/clusteroptimizer/namespace.yaml
</span></span></code></pre></div></li>
<li>
<p>通过如下命令创建<code>Deployment</code> <code>optimizer</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    kubectl apply -f ~/setup/clusteroptimizer/optimizer.yaml
</span></span></code></pre></div><blockquote>
<p>注意：若数据库信息与[初始化数据库]中提供的不一致，则需要调整文件<code>~/setup/clusteroptimizer/optimizer.yaml</code>中的<strong>ConfigMap</strong><code>optimizer-conf</code>，将其配置项<code>optimize</code>和<code>storage</code>下的<code>dataSource.name</code>值中的用户名、用户密码、数据库地址和端口调整为Mysql数据库的相应信息。</p>
</blockquote>
</li>
<li>
<p>通过如下命令检查<code>optimizer</code>是否正常运行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    kubectl get pods -n wiseinf-system
</span></span></code></pre></div><p>若正常运行，则可以获取到如下输出：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    NAME                         READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>    optimizer-5b956655df-gspq6   2/2     Running   <span style="color:#ae81ff">0</span>          1m
</span></span></code></pre></div></li>
<li>
<p>通过如下命令创建 <strong>port-forward</strong> 来访问 <code>optimizer</code> 服务：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    kubectl port-forward svc/optimizer 80:80
</span></span></code></pre></div></li>
<li>
<p>打开浏览器，访问地址<code>http://localhost/</code>.</p>
</li>
<li>
<p>若能够看到  <strong>Cluster Optimizer</strong>首页，则应用<strong>Cluster Optimizer</strong>成功部署.</p>
</li>
</ol>
<h2 id="下一步导入集群">下一步：导入集群</h2>
<p>下一步，您可以添加一个集群，查看其相关优化建议。详见：</p>
<ul>
<li><a href="/docs/cluster-optimizer/import-aws">导入AWS EKS集群</a></li>
<li><a href="/docs/cluster-optimizer/import-alibaba">导入阿里云集群</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-da59e19291384c4c46aa84925c92b66c">1.2 - 导入AWS EKS集群</h1>
    <div class="lead">描述导入AWS EKS集群的详细步骤.</div>
	

<div class="pageinfo pageinfo-primary">
<p>本节描述导入AWS EKS集群的详细步骤。</p>

</div>

<h2 id="前置条件">前置条件</h2>
<ol>
<li>需要提供一个Access Key &amp; Secret，其权限策略如下：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&#34;Sid&#34;</span>: <span style="color:#e6db74">&#34;Optimizer&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;ec2:DescribeInstances&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;ec2:DescribeLaunchTemplates&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;ec2:DescribeRegions&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;ec2:DescribeVolumes&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;ec2:DescribeLaunchTemplateVersions&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;eks:DescribeNodegroup&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;eks:ListNodegroups&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;eks:DescribeCluster&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;eks:ListClusters&#34;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;autoscaling:DescribeAutoScalingInstances&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;autoscaling:DescribeAutoScalingGroups&#34;</span>,
</span></span><span style="display:flex;"><span>			],
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="2">
<li>
<p>一个Kubernetes集群，版本1.22及以上，推荐使用EKS集群.</p>
</li>
<li>
<p>需要提供一个Kubeconfig，用于访问集群相关信息。其权限要求如下（若仅为开发测试集群，无敏感信息，为简单起见，也可以授予集群的全部只读权限）：</p>
</li>
</ol>
<pre tabindex="0"><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: optimizer
rules:
  - apiGroups:
      - &#34;&#34;
    resources:
      - nodes
      - pods
      - pods/status
      - persistentvolumes
      - persistentvolumeclaims
      - services
      - namespaces
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - &#34;apps/v1&#34;
    resources:
      - deployments
      - replicasets
      - replicationcontollers
      - statefulsets
      - daemonsets
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - &#34;batch/v1&#34;
    resources:
      - jobs
      - cronjobs
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - &#34;storage/v1&#34;
    resources:
      - storageclasses
    verbs:
      - get
      - list
      - watch
</code></pre><ol start="4">
<li>
<p>集群所对应的Prometheus/Thanos地址。</p>
</li>
<li>
<p>应用需要能够访问EKS集群和Prometheus/Thanos。</p>
</li>
</ol>
<h2 id="导入-kuberentes-集群">导入 Kuberentes 集群</h2>
<h3 id="添加云账号">添加云账号</h3>
<ol>
<li>
<p>从<code>设置 --&gt; 云账号</code>进入云账号管理页面，如下图。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-aws/cp01_hu03e0d36738a99241f0258c58153cc52a_133032_900x0_resize_catmullrom_3.png" width="900" height="346">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
   云账户管理
   <small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>
</p>
</li>
<li>
<p>单击<code>新增</code>按钮添加云帐户。 可以输入<code>名称</code>，选择<code>Amazon AWS</code>作为<code>云提供商</code>，然后输入<code>Access Key</code>和<code>Access Key Secret</code>，最后单击<code>确认</code>。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 510px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-aws/cp02_hua7b8feaf3e61f1e8ae01dace0e07ff3c_89797_500x0_resize_catmullrom_3.png" width="500" height="350">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
   添加云账号
   <small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>
</p>
</li>
</ol>
<blockquote>
<p>输入<code>Access Key</code>和<code>Access Key Secret</code>后，您还可以通过单击底部<code>测试连通性</code>按钮来测试访问凭据是否能够正常连接到云提供商。</p>
</blockquote>
<h3 id="导入集群">导入集群</h3>
<ol>
<li>
<p>从<code>Settings --&gt; Clusters</code>进入集群管理页面，如下图。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-aws/cluster01_hu9176d6dc9a718231961b0d97170bdd2f_135376_900x0_resize_catmullrom_3.png" width="900" height="345">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
     集群管理
     <small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

</li>
<li>
<p>单击<code>导入集群</code>按钮，然后单击<code>AWS</code>云提供商徽标以开始从AWS导入集群。 它包含五个步骤：</p>
<ol>
<li>连接AWS</li>
<li>连接kubernetes</li>
<li>连接Metrics Server</li>
<li>查看配置</li>
<li>完成</li>
</ol>
</li>
<li>
<p>在<code>连接AWS</code>步骤中，选择<code>使用已有凭据</code>，选择<code>添加云帐户</code>部分中创建的云帐户，如下图。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-aws/cluster02_hu5da7e645ebdf21daae59978646d3f111_103946_600x0_resize_catmullrom_3.png" width="600" height="184">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
    导入集群：连接到 AWS
    <small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>然后单击<code>下一步</code>按钮转到<code>连接kubernetes</code>步骤。</p>
</li>
<li>
<p>在<code>连接kubernetes</code>步骤中，选择<code>Managed cluster</code>，如下图。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-aws/cluster03_hud9c96ab7511ddd9c88a1138f6076c603_69941_600x0_resize_catmullrom_3.png" width="600" height="402">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
     导入集群：连接kubernetes集群
     <small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

先选择<code>地域</code>，然后选择<code>集群</code>，然后输入以下字段：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>描述</code></td>
<td style="text-align:left">集群描述</td>
</tr>
<tr>
<td style="text-align:left"><code>使用私有API Server私有地址</code></td>
<td style="text-align:left">是否使用私有API Server地址。</td>
</tr>
<tr>
<td style="text-align:left"><code>Kubeconfig</code></td>
<td style="text-align:left">连接到集群的Kubeconfig。</td>
</tr>
<tr>
<td style="text-align:left"><code>自动刷新Kubeconfig</code></td>
<td style="text-align:left">是否自动刷新kubeconfig。</td>
</tr>
<tr>
<td style="text-align:left"><code>节点组标签</code></td>
<td style="text-align:left">用于标识节点所属的节点组。 对于EKS，默认值为<code>eks.amazonaws.com/nodegroup</code>。</td>
</tr>
</tbody>
</table>
<p>然后单击<code>下一步</code>按钮转到<code>连接Metrics服务</code>步骤。</p>
</li>
<li>
<p>在<code>连接Metrics服务</code>步骤中，输入以下字段，如下所示。</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>是否Thanos</code></td>
<td style="text-align:left">若Metrics Server是 Thanos，则应选中此项。</td>
</tr>
<tr>
<td style="text-align:left"><code>Metrics服务地址</code></td>
<td style="text-align:left">Metrics服务器地址，目前支持Prometheus和Thanos。</td>
</tr>
<tr>
<td style="text-align:left"><code>限制访问速率</code></td>
<td style="text-align:left">是否取用到Metrics服务地址的访问速率限制。</td>
</tr>
<tr>
<td style="text-align:left"><code>最大并发数</code></td>
<td style="text-align:left">指定访问Metrics服务地址的最大并发数。</td>
</tr>
<tr>
<td style="text-align:left"><code>集群标签</code></td>
<td style="text-align:left">用作标签名称，用于从Metrics服务过滤集群的指标。</td>
</tr>
<tr>
<td style="text-align:left"><code>集群标签值</code></td>
<td style="text-align:left">用作标签值，用于从Metrics服务过滤集群的指标。</td>
</tr>
</tbody>
</table>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-aws/cluster04_hu0112fb4d51d80dd867d083f5cfd596aa_161889_600x0_resize_catmullrom_3.png" width="600" height="298">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
     导入集群：连接Metrics服务
     <small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>然后单击<code>下一步</code>按钮转到<code>查看配置</code>步骤。</p>
</li>
<li>
<p>在<code>查看配置</code>步骤中，显示连接AWS、连接Kubernetes、连接Metrics服务的配置。您可以检查配置是否符合预期。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-aws/cluster05_hu40b82eafc01e7c739345cb73b7ef10b6_92895_600x0_resize_catmullrom_3.png" width="600" height="400">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
     导入集群：查看配置
     <small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

确认这些配置后，您可以单击<code>导入</code>按钮转到<code>完成</code>步骤。</p>
</li>
<li>
<p>在<code>完成</code>步骤中，会显示提交状态，如下图。 当提交状态显示集群已导入时，您可以点击<code>完成</code>按钮。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-aws/cluster06_hu22b48c65ecca83a58588b4e4e27d48ad_92029_600x0_resize_catmullrom_3.png" width="600" height="399">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
     导入集群：完成
     <small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

</li>
</ol>
<h2 id="下一步">下一步</h2>
<p>导入集群后，您可以查看集群多个方面的优化建议，包括：</p>
<ul>
<li><a href="/docs/clusteroptimizer/nodegroup">节点组</a></li>
<li><a href="/docs/clusteroptimizer/node">节点</a></li>
<li><a href="/docs/clusteroptimizer/disk">磁盘</a></li>
<li><a href="/docs/clusteroptimizer/pv">持久卷</a></li>
<li><a href="/docs/clusteroptimizer/application">应用程序</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ab611226a338ba3cf65a94042e8aa36a">1.3 - 导入阿里云集群</h1>
    <div class="lead">描述导入阿里云集群的详细步骤.</div>
	

<div class="pageinfo pageinfo-primary">
<p>本节描述导入阿里云集群的详细步骤。</p>

</div>

<h2 id="前置条件">前置条件</h2>
<ol>
<li>
<p>获取阿里云Access Key和Access Key Secret，具备如下权限。具体申请过程请参考<a href="https://help.aliyun.com/document_detail/116401.htm">创建Access Key</a>。</p>
<table>
<thead>
<tr>
<th>服务</th>
<th>权限</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>云服务器（ECS）</td>
<td>ecs:DescribeDisks<br/> ecs:DescribeInstances<br/> ecs:DescribeRegions</td>
<td>需此权限获取磁盘、实例和地域信息</td>
</tr>
<tr>
<td>容器服务Kubernetes版（CS）</td>
<td>cs:DescribeClusterNodePools<br/> cs:DescribeClusterNodePoolDetail<br/> cs:DescribeClusters <br/> cs:DescribeClusterUserKubeconfig<br/> cs:DescribeClusterNodes</td>
<td>需此权限获取集群、节点池、节点、Kubeconfig等信息</td>
</tr>
</tbody>
</table>
<p>其权限策略文件描述如下，您可以直接在阿里云控制台中导入该策略，具体请参考<a href="https://help.aliyun.com/zh/ram/user-guide/create-a-custom-policy#section-kwn-gu8-48m">通过脚本编辑模式创建自定义权限策略</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecs:DescribeDisks&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecs:DescribeInstances&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ecs:DescribeRegions&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Condition&#34;</span>: {}
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cs:DescribeClusterNodePools&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cs:DescribeClusterNodePoolDetail&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cs:DescribeClusters&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cs:DescribeClusterUserKubeconfig&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cs:DescribeClusterNodes&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Condition&#34;</span>: {}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p>阿里云Kubernetes集群Kubeconfig。集群版本1.22及以上，建议使用ACK集群。具体请参见<a href="https://help.aliyun.com/zh/ack/">容器服务Kubernetes版</a>。</p>
</li>
<li>
<p>Kubeconfig需具备如下权限。</p>
<table>
<thead>
<tr>
<th>资源</th>
<th>权限</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Node</td>
<td>List<br/>Get<br/> Watch</td>
<td>获取节点信息</td>
</tr>
<tr>
<td>Pod</td>
<td>List<br/>Get<br/> Watch</td>
<td>获取Pod信息</td>
</tr>
<tr>
<td>Namespace</td>
<td>List<br/>Get<br/> Watch</td>
<td>获取Namespace信息</td>
</tr>
<tr>
<td>Service</td>
<td>List<br/>Get<br/> Watch</td>
<td>获取Service信息</td>
</tr>
<tr>
<td>Persistent Volume<br/> Persistent Volume Claim</td>
<td>List<br/>Get<br/> Watch</td>
<td>获取Persistent Volume、Persistent Volume Claim信息</td>
</tr>
<tr>
<td>Deployment<br/>StatefulSet<br/>DaemonSet<br/><br/>ReplicaSet<br>ReplicationControllers<br/></td>
<td>List<br/>Get<br/> Watch</td>
<td>获取Deployment、StatefulSet、DaemonSet、ReplicaSet、ReplicationContoller信息</td>
</tr>
<tr>
<td>Job<br/>CronJob</td>
<td>List<br/>Get<br/> Watch</td>
<td>获取Job和CronJob信息</td>
</tr>
</tbody>
</table>
</li>
</ol>
<p>权限文件如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">optimizer</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">nodes</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">pods</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">pods/status</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">persistentvolumes</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">persistentvolumeclaims</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">services</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">namespaces</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">get</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">list</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">watch</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;apps/v1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">deployments</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">replicasets</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">replicationcontollers</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">statefulsets</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">daemonsets</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">get</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">list</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">watch</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;batch/v1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">jobs</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">cronjobs</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">get</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">list</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">watch</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;storage/v1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">storageclasses</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">get</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">list</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">watch</span>
</span></span></code></pre></div><ol start="4">
<li>Prometheus监控或者Thanos监控。该监控用于给集群中的节点、容器等提供监控数据。</li>
</ol>
<h2 id="导入步骤">导入步骤</h2>
<h3 id="添加阿里云账号">添加阿里云账号</h3>
<ol>
<li>选择<code>设置</code>菜单，选择<code>云账户</code>标签页即可进入云账户管理页面。默认情况下，该页面将分页展示平台管理的所有云账户，包括名称以及相应的云服务商，同时也提供了操作栏，方便用户进行相应的操作，如下图所示。</li>
</ol>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-alibaba/cp01_hu03e0d36738a99241f0258c58153cc52a_133032_900x0_resize_catmullrom_3.png" width="900" height="346">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
云账户管理主页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<ol start="2">
<li>在云账户管理页面，点击新增按钮，即可添加云账户，其界面如下所示。在此界面中，用户依次输入云账户名称、选择相应的云服务商、输入Access Key和Access Key Secret，点击确定按钮，即可完成云账户添加。添加完参数后，用户也可以点击测试连通性按钮，测试该云账户是否正确。平台目前支持阿里云，可从云服务商下拉框处进行选择。Access Key和Access Key Secret为访问该云服务的账号信息，请从相应的云服务商处获取。</li>
</ol>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 510px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-alibaba/cp02_hued1b873e3939167d1f90bbc9956d703f_88202_500x0_resize_catmullrom_3.png" width="500" height="349">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
添加云账户界面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<h3 id="添加阿里云集群">添加阿里云集群</h3>
<ol>
<li>
<p>选择<code>设置</code>菜单，选择集群标签进入集群管理页面。默认情况下，该页面将分页展示平台管理的所有集群，包括名称、集群ID集群地域、Access Token名称，对应的云服务商以及Prometheus地址，同时也提供了操作栏，方便用户进行相应的操作，如下图所示。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-alibaba/cluster01_hu9176d6dc9a718231961b0d97170bdd2f_135376_900x0_resize_catmullrom_3.png" width="900" height="345">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
集群管理主页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>
</p>
</li>
<li>
<p>点击<code>导入集群</code>按钮即弹出导入对话框，可在此导入集群。导入集群分为5个步骤，目前仅支持阿里云集群。</p>
<ol>
<li>设置阿里云访问凭据</li>
<li>连接Kubernetes集群</li>
<li>连接Prometheus</li>
<li>查看配置</li>
<li>完成</li>
</ol>
</li>
<li>
<p>设置阿里云访问凭据界面如下图所示。在阿里云访问凭据界面，通过使用已有凭据来设置阿里云访问凭据，此处选择<code>添加阿里云账号</code>中添加的阿里云账号，如下图所示。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-alibaba/cluster02_hu1c31429098f21b498269d5cb833fbb5a_36097_600x0_resize_catmullrom_3.png" width="600" height="180">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
导入集群界面-设置阿里云访问凭据
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>
</p>
</li>
<li>
<p>设置完阿里云访问凭据后，点击下一步按钮，即可进入连接Kubernetes集群页面，如下图所示。平台支持连接2种类型的Kubernetes集群，包括托管集群和自建集群。连接托管集群页面如下图所示。此处我们选择托管集群，平台通过云账户自动获取用户集群，用户通过集群下拉框来选择相应的集群、输入描述字段、选择是否使用API Server私网地址、选择是否自动刷新KubeConfig以及KubeConfig生命周期，最后输入节点组标签即可。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-alibaba/cluster03_huf967536d5598092106c34f3f82d1cb13_70685_600x0_resize_catmullrom_3.png" width="600" height="402">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
连接Kubernetes集群页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>
</p>
</li>
<li>
<p>连接Prometheus页面如下图所示。用户在此页面输入信息后，点击下一步按钮进入查看配置页面。输入信息明细如下表所示。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-alibaba/cluster04_hu67aa74e912d2dee9d3d5894effdd2bce_55184_600x0_resize_catmullrom_3.png" width="600" height="291">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
连接Prometheus页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

连接Prometheus参数说明如表所示：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">是否Thanos</td>
<td style="text-align:left">若后端集群为Thanos，则应勾选此项。</td>
</tr>
<tr>
<td style="text-align:left">Prometheus地址</td>
<td style="text-align:left">Prometheus地址，必须可访问。</td>
</tr>
<tr>
<td style="text-align:left">限制访问速率</td>
<td style="text-align:left">若需要现在平台对Prometheus的访问速率，则应勾选此项。</td>
</tr>
<tr>
<td style="text-align:left">最大并发数</td>
<td style="text-align:left">平台访问Prometheus的最大并发数。</td>
</tr>
<tr>
<td style="text-align:left">集群标签</td>
<td style="text-align:left">集群标签用于从Prometheus或者Thanos中筛选该集群的监控指标</td>
</tr>
<tr>
<td style="text-align:left">集群标签值</td>
<td style="text-align:left">集群标签值用于从Prometheus或者Thanos中筛选该集群的监控指标</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>查看配置页面如下图所示，该页面显示了阿里云访问凭据、连接Kubernetes集群和连接Prometheus集群的详细参数，方便用户确认。当用户完成确认后，点击导入按钮，即可进入完成页面。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-alibaba/cluster05_hu9261c2475cadc8e4d3fff70ff73fec33_104529_600x0_resize_catmullrom_3.png" width="600" height="399">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
查看配置页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>
</p>
</li>
<li>
<p>完成页面如图下图所示，页面将显示提交情况。点击完成，即完成集群导入。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/import-alibaba/cluster06_hue342ed2e8dafaac92ae2ef6445d6fe9a_48286_600x0_resize_catmullrom_3.png" width="600" height="199">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
完成页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>
</p>
</li>
</ol>
<h2 id="下一步操作">下一步操作</h2>
<p>导入集群完成后，等待一段时间（等待优化策略完成调度和执行），即可查看该集群多个维度的优化建议，包括：</p>
<ul>
<li><a href="/docs/clusteroptimizer/nodegroup">节点组</a></li>
<li><a href="/docs/clusteroptimizer/node">节点</a></li>
<li><a href="/docs/clusteroptimizer/disk">磁盘</a></li>
<li><a href="/docs/clusteroptimizer/pv">Persistent volume</a></li>
<li><a href="/docs/clusteroptimizer/application">应用</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cbcde0fe6010529c37131204023b7771">1.4 - 集群概览</h1>
    <div class="lead">查看平台中连接的集群。</div>
	

<div class="pageinfo pageinfo-primary">
<p>查看平台中连接的集群。</p>

</div>

<p>点击平台左侧菜单栏的<code>集群</code>，显示集群概览页，如下图所示。主展示区将展示平台管理的集群列表。包括集群（集群名称和集群ID）、集群地域、Access Token名称、云服务商和Prometheus地址等信息。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/overview/overview_huc51d5935651b648a35188d358af3790b_63590_600x0_resize_catmullrom_3.png" width="600" height="264">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
集群概览页
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a8e419965395a39fb951fa1137e17781">1.5 - 节点池优化</h1>
    <div class="lead">描述节点池相关信息及优化建议。</div>
	

<div class="pageinfo pageinfo-primary">
<p>描述了一站式云原生集群优化平台（Cluster Optimizer）提供的集群优化操作。</p>

</div>

<h2 id="查看节点池">查看节点池</h2>
<p>点击平台左侧菜单栏的<code>节点组</code>菜单，则显示节点组页，如图 39所示。节点组页分为3个区：</p>
<ol>
<li>集群选择区：选择相应的集群。</li>
<li>查询区：可根据节点组名称和节点组ID过滤列表项。</li>
<li>列表区：展示节点组的信息、其当前设置和优化设置。</li>
</ol>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/nodegroup/ng1_hu5eadd621fabeabe5401645eb35929a15_31462_600x0_resize_catmullrom_3.png" width="600" height="324">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
节点组页
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>用户选择集群后，列表区显示分为4栏：</p>
<ol>
<li>节点组栏：展示节点组名称和节点组ID。</li>
<li>当前设置栏：展示节点组当前的实例类型、是否自动扩缩容、最小节点数和最大节点数。</li>
<li>优化设置栏：展示平台智能推荐的节点组实例类型、推荐是否启动扩缩容、推荐的最小节点数和最大节点数。</li>
<li>操作栏：展示对节点组相应的操作。，</li>
</ol>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/nodegroup/ng2_hufb6d4ad30dc137d423e10af768d0301e_59958_600x0_resize_catmullrom_3.png" width="600" height="320">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
节点组页-选择集群
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<h2 id="调整节点池">调整节点池</h2>
<p>点击上图中的<code>调整</code>链接，可打开调整节点组对话框，如下图所示。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/nodegroup/ng3_hu511fdf49d71d51d20b7534d23c9a8b4b_71557_800x0_resize_catmullrom_3.png" width="800" height="410">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
调整节点组对话框
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-60fb2e0d684559cca943f114bbb23b17">1.6 - 节点优化</h1>
    <div class="lead">描述节点相关信息及优化建议。</div>
	

<div class="pageinfo pageinfo-primary">
<p>描述了节点相关信息及优化建议。</p>

</div>

<h2 id="查看节点">查看节点</h2>
<p>点击平台左侧菜单栏的<code>节点</code>菜单，则显示节点页，如下图所示。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/node/node1_hucbd1b26c7c372bc6a3c143a2da6ffa06_32634_600x0_resize_catmullrom_3.png" width="600" height="333">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
节点页
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>节点页分为3个区：</p>
<ol>
<li>集群选择区：选择相应的集群。</li>
<li>查询区：可根据节点组名称和节点组ID过滤列表项。</li>
<li>列表区：展示节点组的信息、其当前设置和优化设置。</li>
</ol>
<p>选择集群的节点页如下所示：







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/node/node2_hu17fda8b599b1f8ac4ecabc25c3b623cd_82280_600x0_resize_catmullrom_3.png" width="600" height="418">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
节点页-选择集群
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>
</p>
<p>列表区显示分为5栏：</p>
<ol>
<li>节点信息栏：展示节点名称、实例ID和地域信息。</li>
<li>当前设置栏：展示节点的实例类型、CPU核数和内存大小。</li>
<li>策略名称栏：展示节点优化所使用的策略，目前仅支持低利用率节点策略。</li>
<li>详情栏：展示策略所提供的信息。例如，对于低利用率节点策略来说，会观测CPU和内存的平均利用率，并同平台设置的阈值进行比较，帮助用户调整节点实例类型。</li>
<li>操作栏：展示对节点相应的操作</li>
</ol>
<h2 id="调整节点">调整节点</h2>
<p>点击<code>调整</code>链接可打开调整节点对话框，对话框中展示了详细的调整信息和推荐的调整方案，如下图。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/node/node3_huf100fcca64e7c4f80e6e88bb3833e1ea_91312_600x0_resize_catmullrom_3.png" width="600" height="296">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
调整节点页
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-41a35fffa4c7fd6466728b424aab2998">1.7 - 磁盘优化</h1>
    <div class="lead">描述磁盘相关信息及优化建议。</div>
	

<div class="pageinfo pageinfo-primary">
<p>描述了磁盘相关信息及优化建议。</p>

</div>

<h2 id="查看磁盘">查看磁盘</h2>
<p>点击平台左侧菜单栏的<code>磁盘</code>菜单，则显示磁盘页，如下图所示。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/disk/disk1_hu8eff269808ad90ec2980f382e0103d36_32479_600x0_resize_catmullrom_3.png" width="600" height="334">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
磁盘页
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>磁盘页分为3个区：</p>
<ol>
<li>集群选择区：选择相应的集群。</li>
<li>查询区：以通过磁盘ID、实例ID和节点名称来查询相应的磁盘。</li>
<li>列表区：展示磁盘、实例、用量和操作栏。</li>
</ol>
<p>选择集群后的磁盘页如下所示：</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/disk/disk2_hu5d129aa695fec5b501fbe2af2fc02371_92321_600x0_resize_catmullrom_3.png" width="600" height="406">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
磁盘页-选择集群
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>列表区显示分为4栏：</p>
<ol>
<li>磁盘栏：展示磁盘ID、设备名称和创建时间。</li>
<li>实例栏：展示磁盘所在的节点ID、节点名称和地域。</li>
<li>用量栏：展示磁盘容量、最大利用率、平均利用率和最后更新时间。</li>
<li>操作栏：展示对磁盘相应的操作。</li>
</ol>
<h2 id="调整磁盘">调整磁盘</h2>
<p>点击<code>调整</code>链接可打开调整磁盘大小对话框，其中展示了磁盘详细的调整信息和推荐的调整方案，如下图。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/disk/disk3_hu8aac8a7a4525283cb7f898defaa8e7e4_130288_600x0_resize_catmullrom_3.png" width="600" height="332">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
调整磁盘页
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ec4c2c1254809868f664e7266e289938">1.8 - Persistent Volume优化</h1>
    <div class="lead">描述Persistent Volume相关信息及优化建议。</div>
	

<div class="pageinfo pageinfo-primary">
<p>描述了Persistent Volume相关信息及优化建议。</p>

</div>

<h2 id="查看persistent-volume">查看Persistent Volume</h2>
<p>点击平台左侧菜单栏的<code>Persistent Volume</code>菜单，则显示Persistent Volume页，如下图所示。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/pv/pv1_hue512a9c09cea6c77b3077e30f8fff04e_41899_600x0_resize_catmullrom_3.png" width="600" height="365">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
Persistent Volume页
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>Persistent Volume页分为3个区：</p>
<ol>
<li>集群选择区：选择相应的集群。</li>
<li>查询区：可根据名称、PVC名称空间、PVC名称和策略名称过滤列表项。</li>
<li>列表区：展示PV、PVC、策略名称、用量、最近更新时间和操作栏。</li>
</ol>
<p>择集群后的磁盘页如下所示：</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/pv/pv2_hu4f738f43cdbc3a30690ded55f2dfade5_68487_600x0_resize_catmullrom_3.png" width="600" height="395">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
Persistent Volume页-选择集群
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>列表区显示分为6栏：</p>
<ol>
<li>PV栏：展示PV名称、地域、容量和创建时间。</li>
<li>PVC栏：展示PVC名称空间和名称。</li>
<li>策略名称栏：展示优化策略名称，目前包含未使用PV和低利用率PV两条优化策略。</li>
<li>用量栏：展示PV的用量，仅在低利用率PV优化策略下有效。</li>
<li>最近更新时间栏：展示最后更新时间。</li>
<li>操作栏：展示对磁盘相应的操作。</li>
</ol>
<h2 id="删除persistent-volume">删除Persistent Volume</h2>
<p>选择策略名称栏是<code>未使用PV</code>的行，点击该行操作栏中的<code>删除</code>链接可打开<code>删除Persistent Volume</code>对话框，其中展示了Persistent Volume详细信息和推荐方案，如下图。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/pv/pv3_huee2a4ef5fd2b1fcd4d17f5564833ef4e_81179_600x0_resize_catmullrom_3.png" width="600" height="263">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
删除Persistent Volume对话框
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<h2 id="调整persistent-volume大小">调整Persistent Volume大小</h2>
<p>选择策略名称栏是<code>低利用率PV</code>的行，点击该行操作栏中的<code>调整</code>链接可打开<code>调整Persistent Volume大小</code>对话框，其中展示了Persistent Volume详细信息和推荐的调整方案，如下图。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/pv/pv4_huf3cacc24f0cdb0b5330e8b22584ca8bc_89249_600x0_resize_catmullrom_3.png" width="600" height="267">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
调整Persistent Volume大小
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-077e156274fb7d892f55e54292de72da">1.9 - 应用优化</h1>
    <div class="lead">描述应用详情以及优化建议。</div>
	

<div class="pageinfo pageinfo-primary">
<p>描述了应用详情以及优化建议。</p>

</div>

<h2 id="查看应用">查看应用</h2>
<p>点击平台左侧菜单栏的<code>应用</code>菜单，则显示应用页，如下图所示。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/app/app1_hu0e8572a06a553eaf35c04e55defb382f_42248_600x0_resize_catmullrom_3.png" width="600" height="368">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
应用
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>应用页分为3个区：</p>
<ol>
<li>集群选择区：选择相应的集群。</li>
<li>查询区：可通过名称空间、负载名称、负载类型、容器和策略名称进行查询。目前，平台支持资源推荐、未设置资源额度、内存溢出策略。</li>
<li>列表区：展示名称、容器、当前设置、策略名称、详情和操作栏，不同的策略名称，其展示信息会有一些差异。</li>
</ol>
<p>集群选择区选择集群后，平台默认聚合所有策略的结果，以列表方式展示，如下图所示。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/app/app2_hu187479d7b507b5da0307817a4d09e4e5_88689_600x0_resize_catmullrom_3.png" width="600" height="355">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
应用：选择集群
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<h2 id="资源推荐">资源推荐</h2>
<h3 id="查看资源推荐相关应用">查看资源推荐相关应用</h3>
<p>若策略名称为资源推荐，则列表区如上图所示。列表区显示分为6栏，分别是：</p>
<ol>
<li>名称栏：展示负载名称、名称空间和负载类型。</li>
<li>容器栏：展示容器名称。</li>
<li>当前设置：展示该容器的CPU Request、CPU Limit、内存Request和内存Limit。</li>
<li>策略名称：展示策略名称。</li>
<li>详情：展示CPU平均使用量、CPU最大使用量、内存平均使用量、内存最大使用量、CPU Request推荐值、CPU Limit推荐值、内存Request推荐值、内存Limit推荐值和最近更新时间。</li>
<li>操作栏：展示对应用相应的操作</li>
</ol>
<h3 id="调整资源额度">调整资源额度</h3>
<p>点击<code>调整</code>链接可打开调整资源额度对话框，其中展示应用详情、推荐值及相应调整语句，如下图所示。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/app/app3_hu880b20b69e27095c3257d5800759b1ca_101268_600x0_resize_catmullrom_3.png" width="600" height="354">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
应用：调整资源额度对话框
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<h2 id="未设置资源配额">未设置资源配额</h2>
<h3 id="查看未设置资源配额应用">查看未设置资源配额应用</h3>
<p>若策略名称为未设置资源配额，则列表区展示如下图所示：</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/app/app4_hu0b892833f020343598f6e01ff192f5b1_108403_600x0_resize_catmullrom_3.png" width="600" height="373">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
应用：选择未设置资源配额策略
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>列表区显示分为6栏，分别是：</p>
<ol>
<li>名称栏：展示负载名称、名称空间和负载类型。</li>
<li>容器栏：展示容器名称。</li>
<li>当前设置：展示该容器的CPU Request、CPU Limit、内存Request和内存Limit是否已设置。</li>
<li>策略名称：展示策略名称。</li>
<li>详情：展示CPU Request推荐值、CPU Limit推荐值、内存Request推荐值、内存Limit推荐值和最近更新时间。</li>
<li>操作栏：展示对应用相应的操作，</li>
</ol>
<h3 id="设置应用资源额度">设置应用资源额度</h3>
<p>点击上图中的<code>调整</code>链接可打开设置应用资源额度对话框，其中展示应用详情、推荐值及相应调整语句，如下图所示。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/app/app5_hu8eee30d7aabf93c614c152e877d8928c_104423_600x0_resize_catmullrom_3.png" width="600" height="333">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
应用：设置应用资源额度对话框
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<h2 id="内存溢出">内存溢出</h2>
<h3 id="查看内存溢出应用">查看内存溢出应用</h3>
<p>若策略名称为内存溢出，则列表区展示如下图所示：</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/app/app6_hu87adbcc83246ec23d19ea6547103f818_100585_600x0_resize_catmullrom_3.png" width="600" height="255">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
应用：选择内存溢出策略
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>列表区显示分为6栏，分别是：</p>
<ol>
<li>名称栏：展示负载名称、名称空间和负载类型。</li>
<li>容器栏：展示容器名称。</li>
<li>当前设置：展示该容器的内存Request和内存Limit。</li>
<li>策略名称：展示策略名称。</li>
<li>详情：展示最近OOM时间、最近OOM Pod、OOM次数和和最近更新时间。</li>
<li>操作栏：展示对应用相应的操作。</li>
</ol>
<h3 id="调整应用内存大小">调整应用内存大小</h3>
<p>点击调整链接可打开调整应用内存大小对话框，其中展示应用详情、推荐内存限制值及相应调整语句，如下图所示。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/zh-cn/docs/cluster-optimizer/app/app7_hu817d781025a27b6e9bcd825a497738ca_96820_600x0_resize_catmullrom_3.png" width="600" height="308">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
应用：调整应用内存大小对话框
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ec768fe1731869c4e5952255d641c790">1.10 - 集群优化操作</h1>
    <div class="lead">描述云原生集群优化平台（Cluster Optimizer）提供的集群优化操作。</div>
	

<div class="pageinfo pageinfo-primary">
<p>描述了云原生集群优化平台（Cluster Optimizer）提供的集群优化操作。</p>

</div>

<p>集群优化操作主要包括：</p>
<ul>
<li>调整节点池</li>
<li>调整节点</li>
<li>调整磁盘</li>
<li>&hellip;</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b44e424da94f6990e4d02978cbc967a9">1.10.1 - 调整节点池</h1>
    <div class="lead">调整节点池。</div>
	

<div class="pageinfo pageinfo-primary">
<p>描述了调整节点池的操作。</p>

</div>

<h2 id="阿里云">阿里云</h2>
<h3 id="前提条件">前提条件</h3>
<ul>
<li>具备编辑节点池权限。</li>
</ul>
<h3 id="操作步骤">操作步骤</h3>
<ol>
<li>登录容器服务管理控制台，在左侧导航栏选择集群。</li>
<li>在集群列表页面，单击目标集群名称，然后在左侧导航栏，选择节点管理 &gt; 节点池。</li>
<li>在节点池列表页面中，单击目标节点池所在行操作列的编辑。</li>
<li>在编辑节点池页面，编辑节点池的配置项。节点池优化主要关注<strong>实例规格</strong>和<strong>自动伸缩</strong>配置项。
<ol>
<li>根据调整节点池对话框中推荐的实例规则，在<strong>实例规格</strong>中选择相应的实例规格。</li>
<li>根据调整节点池对话框中推荐的自动扩缩容、最小节点数和最大节点数，在<strong>自动伸缩</strong>配置项中进行调整。若没有开启集群自动弹性伸缩，可参考<a href="https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/auto-scaling-of-nodes#section-i4v-dgt-7wv">节点自动伸缩</a>进行配置。</li>
</ol>
</li>
</ol>
<p>想了解更多细节，请参考：<a href="https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/edit-node-pool">编辑节点池</a></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5db2c5107c2c5b867fd9b6b316f9f181">1.10.2 - 调整节点</h1>
    <div class="lead">调整节点。</div>
	

<div class="pageinfo pageinfo-primary">
<p>描述了调整节点的操作。</p>

</div>

<h2 id="阿里云">阿里云</h2>
<h3 id="前提条件">前提条件</h3>
<p>TBD&hellip;</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-25ff9c4e42700bf130854451e52d2fb1">1.10.3 - 调整磁盘</h1>
    <div class="lead">调整磁盘。</div>
	

<div class="pageinfo pageinfo-primary">
<p>描述了调整磁盘的操作。</p>

</div>

<h2 id="阿里云">阿里云</h2>
<h3 id="前提条件">前提条件</h3>
<p>TBD&hellip;</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cf75811c0797e8dc5e66957ac96debfb">1.10.4 - 删除Persistent Volume</h1>
    <div class="lead">删除Persistent Volume。</div>
	

<div class="pageinfo pageinfo-primary">
<p>描述了删除Persistent Volume的操作。</p>

</div>

<h2 id="阿里云">阿里云</h2>
<h3 id="前提条件">前提条件</h3>
<p>TBD&hellip;</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dacaf1e373c2472c1efbf2a9b2acf54b">2 - Wisecost：云原生成本管理和优化平台</h1>
    <div class="lead">云原生应用成本管理平台.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Wisecost提供了云原生应用成本监控、管理和优化能力。</p>

</div>

<p>Wisecost能够帮助用户对云原生应用的成本监控、管理和优化，主要功能包括：</p>
<ul>
<li>评估集群整体成本以及分解成本。</li>
<li>评估云原生应用的成本，提供按照名称空间、负载、部门、小组、应用环境等多个维度的成本分析。</li>
<li>提供基础优化建议。</li>
<li>评估集群和应用的健康性。</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d1501d8c0fcaf4a0c0134a7c69ba635e">2.1 - 安装部署</h1>
    <div class="lead">描述了如何安装Wisecost的详细步骤.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Wisecost提供了云原生应用成本监控、管理和优化能力。</p>

</div>

<h2 id="前置条件">前置条件</h2>
<ul>
<li>Mysql数据库，版本5.7及以上</li>
<li>kubernetes集群，版本1.20及以上</li>
</ul>
<h2 id="克隆安装脚本">克隆安装脚本</h2>
<ol>
<li>打开控制台，输入<code>git clone https://github.com/wiseinf/setup.git</code>,将安装脚本克隆到本地。
我们提供了2个仓库地址，方便大家根据需求来克隆到本地。</li>
</ol>
<table>
<thead>
<tr>
<th>仓库</th>
<th style="text-align:left">仓库地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>Github</td>
<td style="text-align:left"><a href="https://github.com/wiseinf/setup.git">https://github.com/wiseinf/setup.git</a></td>
</tr>
<tr>
<td>Gitee</td>
<td style="text-align:left"><a href="https://gitee.com/wiseinf/setup.git">https://gitee.com/wiseinf/setup.git</a></td>
</tr>
</tbody>
</table>
<blockquote>
<p>后续步骤都假设已将<code>setup</code>库克隆到用户主目录，若未克隆到用户主目录，则需要根据实际情况调整命令中的文件路径。</p>
</blockquote>
<h2 id="初始化数据库">初始化数据库</h2>
<blockquote>
<p>假设Mysql数据库主机地址为：<code>127.0.0.1</code>.</p>
</blockquote>
<ol>
<li>
<p>在控制台执行命令<code>mysql -h127.0.0.1 -uroot</code>，输入密码，登录mysql数据库。其中<code>127.0.0.1</code>为Mysql主机地址。</p>
</li>
<li>
<p>在<code>mysql&gt;</code>提示符下执行如下命令，创建<code>storage</code>库和<code>wisecost</code>库，相应表后续由应用程序自动创建。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    mysql&gt; source ~/setup/wisecost/sql/create_database.sql
</span></span></code></pre></div><blockquote>
<p>注意：请关注数据丢失风险。若mysql数据库中已经存在<code>storage</code>库和<code>wisecost</code>库，则上述脚本会删除<code>storage</code>库和<code>wisecost</code>库后创建新库。</p>
</blockquote>
</li>
<li>
<p>在<code>mysql&gt;</code>提示符下执行如下命令，创建<code>wisecost</code>用户（默认密码为<code>Wisecost~</code>）并为其赋予<code>storage</code>库和<code>wisecost</code>库的完全访问权限。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    mysql&gt; source ~/setup/wisecost/sql/create_user.sql
</span></span></code></pre></div></li>
<li>
<p>在控制台执行命令<code>mysql -h127.0.0.1 -uwisecost</code>，输入密码（默认密码为<code>Wisecost~</code>），登录mysql数据库。</p>
</li>
<li>
<p>在<code>mysql&gt;</code>提示符下执行<code>show database</code>，确认<code>storage</code>库和<code>wisecost</code>库已经创建。可以通过<code>select</code>语句（例如<code>select * from storage.pv</code>）查询库中相应的数据表确认用户的权限是否正常。</p>
</li>
<li>
<p>至此，数据库初始化完毕。</p>
</li>
</ol>
<h2 id="部署应用">部署应用</h2>
<ol>
<li>通过 <code>kubectl apply -f ~/setup/wisecost/namespace.yaml</code>将如下文件应用到集群，创建名称空间<code>wiseinf-system</code>。

    
      
    
    
    
    
    	
    
    
    
    
    
    
      
      
      
    
    
    
    
    
    
      <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Namespace</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>: 
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wiseinf-system</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
    </span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wiseinf-system</span>
    </span></span></code></pre></div>
    
</li>
<li>根据Mysql的配置调整文件<code>~/setup/wisecost/wisecost.yaml</code>中的<strong>ConfigMap</strong><code>wisecost-conf</code>，将其配置项<code>optimize</code>和<code>kubestore</code>下的<code>dataSourceName: &quot;wisecost:Wisecost~@tcp(mysql:3306)/wisecost?charset=utf8mb4&amp;parseTime=true</code>中的用户名、用户密码、数据库地址和端口调整为Mysql数据库的相应信息。</li>
<li>通过 <code>kubectl apply -f ~/setup/wisecost/wisecost.yaml</code>将如下文件应用到集群，部署应用<strong>Wise Cost</strong>。

    
      
    
    
    
    
    	
    
    
    
    
    
    
      
      
      
    
    
    
    
    
    
      <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
    </span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">wiseinf-system</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
    </span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">wisecost</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">default.conf</span>: |-<span style="color:#e6db74">
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      server {
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        listen 80;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        location / {
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          root /usr/share/nginx/html/;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          include /etc/nginx/mime.types;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          try_files $uri $uri/ /index.html;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          location /api/ {
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            rewrite ^/api/(.*) /$1 break;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            proxy_set_header Host $host;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            proxy_set_header X-Real-IP $remote_addr;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            proxy_set_header X-NginX-Proxy true;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            proxy_pass http://localhost:7070;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          }
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }</span>      
    </span></span><span style="display:flex;"><span>---
    </span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost-conf</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">wiseinf-system</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
    </span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">wisecost</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">wisecost.yaml</span>: |-<span style="color:#e6db74">
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server:
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      port: 7070
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    optimize:
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      dataSourceName: &#34;wisecost:Wisecost~@tcp(mysql:3306)/wisecost?charset=utf8mb4&amp;parseTime=true&#34;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      maxOpenConns: 10
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kubestore:
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      type: mysql
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      parameters:
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        dataSourceName: &#34;wisecost:Wisecost~@tcp(mysql:3306)/storage?charset=utf8mb4&amp;parseTime=true&#34;
    </span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        maxOpenConns: 10</span>    
    </span></span><span style="display:flex;"><span>
    </span></span><span style="display:flex;"><span>---
    </span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
    </span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">wisecost</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">wiseinf-system</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">10</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
    </span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
    </span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">wisecost</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
    </span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
    </span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
    </span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">wisecost</span>
    </span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
    </span></span><span style="display:flex;"><span>      <span style="color:#f92672">hostNetwork</span>: <span style="color:#66d9ef">true</span>
    </span></span><span style="display:flex;"><span>      <span style="color:#f92672">dnsPolicy</span>: <span style="color:#ae81ff">ClusterFirstWithHostNet</span>
    </span></span><span style="display:flex;"><span>      <span style="color:#f92672">securityContext</span>:
    </span></span><span style="display:flex;"><span>        <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">0</span>
    </span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
    </span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost-ui</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">wiseinf/wisecost-ui:701d19d</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">volumeMounts</span>:
    </span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config</span>
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/etc/nginx/conf.d</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">ports</span>:
    </span></span><span style="display:flex;"><span>            - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">resources</span>:
    </span></span><span style="display:flex;"><span>            <span style="color:#f92672">requests</span>:
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">200m</span>
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">500M</span>
    </span></span><span style="display:flex;"><span>            <span style="color:#f92672">limits</span>:
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">1000m</span>
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">2G</span>
    </span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">wiseinf/wisecost:99e308e</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">command</span>:
    </span></span><span style="display:flex;"><span>            - <span style="color:#e6db74">&#34;/wiseinf/wisecost&#34;</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">volumeMounts</span>:
    </span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost-data-volume</span>
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/wiseinf/data</span>
    </span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost-logs-volume</span>
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/wiseinf/logs</span>
    </span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost-conf-volume</span>
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/wiseinf/conf</span>
    </span></span><span style="display:flex;"><span><span style="color:#75715e">#              subPath: wisecost.yml</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">ports</span>:
    </span></span><span style="display:flex;"><span>            - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">7070</span>
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">resources</span>:
    </span></span><span style="display:flex;"><span>            <span style="color:#f92672">requests</span>:
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">200m</span>
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">500M</span>
    </span></span><span style="display:flex;"><span>            <span style="color:#f92672">limits</span>:
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">1000m</span>
    </span></span><span style="display:flex;"><span>              <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">2G</span>
    </span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
    </span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Config for wisecost-ui</span>
    </span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">configMap</span>:
    </span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config</span>
    </span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Configs for wisecost</span>
    </span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost-data-volume</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">hostPath</span>:
    </span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/wisecost/data</span>
    </span></span><span style="display:flex;"><span>            <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate</span>
    </span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost-logs-volume</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">hostPath</span>:
    </span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/wisecost/logs</span>
    </span></span><span style="display:flex;"><span>            <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate</span>
    </span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost-conf-volume</span>
    </span></span><span style="display:flex;"><span>          <span style="color:#f92672">configMap</span>:
    </span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wisecost-conf</span>
    </span></span><span style="display:flex;"><span>---
    </span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
    </span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">wisecost-ui</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>:  <span style="color:#ae81ff">wisecost-ui-service</span>
    </span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
    </span></span><span style="display:flex;"><span>    - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
    </span></span><span style="display:flex;"><span>      <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
    </span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">wisecost</span>
    </span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span></span></span></code></pre></div>
    

<blockquote>
<p>注意：</p>
</blockquote>
</li>
<li>通过<code>kubectl port-forward svc/wisecost-ui-service 80:80</code></li>
<li>访问URL<code>http://localhost</code>，即可看到Wise Cost首页。</li>
<li>至此，应用<strong>Wise Cost</strong>部署完毕。</li>
</ol>
<h2 id="下一步导入集群">下一步：导入集群</h2>
<p>下一步，您可以添加一个集群，查看其各项成本。详见导入集群<a href="/docs/wisecost/import-aliyun">导入阿里云集群</a></p>
<h2 id="附录">附录</h2>
<ul>
<li>脚本<code>create_user.sql</code>

    
      
    
    
    
    
    	
    
    
    
    
    
    
      
      
      
    
    
    
    
    
    
      <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> wisecost<span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;Wisecost~&#39;</span>;
    </span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">storage</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> wisecost<span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>;
    </span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">ON</span> wisecost.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> wisecost<span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>;</span></span></code></pre></div>
    
</li>
<li>脚本<code>create_database.sql</code>

    
      
    
    
    
    
    	
    
    
    
    
    
    
      
      
      
    
    
    
    
    
    
      <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- ----------------------------------------------------------------------------
    </span></span></span><span style="display:flex;"><span><span style="color:#75715e">-- Schema wisecost
    </span></span></span><span style="display:flex;"><span><span style="color:#75715e">-- ----------------------------------------------------------------------------
    </span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">SCHEMA</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span>wisecost<span style="color:#f92672">`</span> ;
    </span></span><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">SCHEMA</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span>wisecost<span style="color:#f92672">`</span> ;
    </span></span><span style="display:flex;"><span>
    </span></span><span style="display:flex;"><span><span style="color:#75715e">-- ----------------------------------------------------------------------------
    </span></span></span><span style="display:flex;"><span><span style="color:#75715e">-- Schema storage
    </span></span></span><span style="display:flex;"><span><span style="color:#75715e">-- ----------------------------------------------------------------------------
    </span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">SCHEMA</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">storage</span><span style="color:#f92672">`</span> ;
    </span></span><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">SCHEMA</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">storage</span><span style="color:#f92672">`</span> ;
    </span></span></code></pre></div>
    
</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f8724eef5ecfc709ba9ec953f1658ee2">2.2 - 导入阿里云集群</h1>
    <div class="lead">本节描述导入阿里云集群的详细步骤.</div>
	

<div class="pageinfo pageinfo-primary">
<p>本节描述导入阿里云集群的详细步骤。</p>

</div>

<ol>
<li>
<p>完成Wisecost安装之后，登录系统，选择“概览”，可见<code>概览页面</code>，







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/import-aliyun/import-aliyun-01_hud8965e357a159a39d1a1f512c93ab966_99152_900x414_fill_catmullrom_smart1_3.png" width="900" height="414">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
概览页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>
</p>
</li>
<li>
<p>在“导入阿里云集群-设置阿里云访问凭据页面”设置<code>Access Key</code>和<code>Access Key Secret</code>，<code>Access Key</code>和<code>Access Key Secret</code>可从阿里云获得，具体请参考<a href="https://help.aliyun.com/document_detail/116401.htm">创建Access Key</a>。设置完成<code>Access Key</code>和<code>Access Key Secret</code>后，点击下一步。系统完成验证<code>Access Key</code>和<code>Access Key Secret</code>的正确性后，进入“导入阿里云集群-Kubernetes集群及访问设置页面”。</p>
</li>
</ol>
<blockquote>
<p>在“导入阿里云集群-设置阿里云访问凭据页面”，也可以选择“使用已有凭据”，选择一个已经存在的凭据。







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/import-aliyun/import-aliyun-02_hu586c8a1becbc05e284939f91daadb27a_113445_900x414_fill_catmullrom_smart1_3.png" width="900" height="414">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
导入阿里云集群-设置阿里云访问凭据页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>
</p>
</blockquote>
<ol start="3">
<li>在“导入阿里云集群-Kubernetes集群及访问设置页面”，可以选择<code>托管集群</code>，也可以选择<code>自建集群</code>。下面以<code>自建集群</code>为例，说明相应的参数。完成参数设置后点击<code>下一步</code>，系统完成参数正确性验证后，进入“导入阿里云集群-设置Prometheus访问页面”</li>
</ol>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>集群地域</td>
<td>集群地域指集群所部署的地域，务必正确制定地域，否则会导致集群无法访问。具体请参见<a href="https://help.aliyun.com/document_detail/40654.htm">地域和可用区</a></td>
</tr>
<tr>
<td>集群ID</td>
<td>唯一标识ID，用于唯一的标识一个集群</td>
</tr>
<tr>
<td>集群名称</td>
<td>集群名称</td>
</tr>
<tr>
<td>描述</td>
<td>集群相关描述</td>
</tr>
<tr>
<td>Kubeconfig</td>
<td>访问集群的Kubeconfig文件，需开通对于集群的只读访问权限。不正确的设置会导致无法访问集群或者获取集群中的对象出错。</td>
</tr>
</tbody>
</table>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/import-aliyun/import-aliyun-03_huc147e3acda1852672af64d72e460f678_213466_900x414_fill_catmullrom_smart1_3.png" width="900" height="414">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
导入阿里云集群-Kubernetes集群及访问设置页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<ol start="4">
<li>在“导入阿里云集群-设置Prometheus访问页面”，设置Prometheus访问地址。完成参数设置后点击<code>下一步</code>，进入<code>导入阿里云集群-导入页面</code>。</li>
</ol>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/import-aliyun/import-aliyun-04_hu3a9e998635effd9d0941e230833f287d_99312_900x414_fill_catmullrom_smart1_3.png" width="900" height="414">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
导入阿里云集群-设置Prometheus访问页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<ol start="5">
<li>在<code>导入阿里云集群-导入页面</code>点击<code>导入</code>按钮，系统提交完信息后，显示<code>导入阿里云集群-导入成功页面</code>。至此，阿里云集群已经导入成功。</li>
</ol>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/import-aliyun/import-aliyun-05_huc147e3acda1852672af64d72e460f678_178791_900x414_fill_catmullrom_smart1_3.png" width="900" height="414">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
导入阿里云集群-导入成功页面
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<ol start="6">
<li>返回“概览页”，可以在列表中看到已经导入的集群。</li>
</ol>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/import-aliyun/import-aliyun-06_hud8965e357a159a39d1a1f512c93ab966_107599_900x414_fill_catmullrom_smart1_3.png" width="900" height="414">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
概览页-已导入阿里云集群
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<ol start="7">
<li>在完成集群导入之后，可以进入“集群”和“成本”标签栏，查看该集群的总体整体以及相应的名称空间的成本。</li>
</ol>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-79c3c5401e75cd51b9d3c28865234518">2.3 - 查看集群成本</h1>
    <div class="lead">描述了如何查看和分析集群整体成本.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Wisecost提供了云原生应用成本监控、管理和优化能力。本文档描述如何查看集群成本及其各项指标含义。</p>

</div>

<h2 id="查看集群整体成本">查看集群整体成本</h2>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/cluster-cost/cluster-1_hu9386f43e6fffa22228347f34146fc35b_156504_900x0_resize_catmullrom_3.png" width="900" height="388">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
集群整体成本
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>








<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/cluster-cost/cluster-2_hu8df7dfe3748412eed29420f91a32e85c_137781_900x0_resize_catmullrom_3.png" width="900" height="358">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
集群整体成本分解
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<h2 id="查看单个集群成本">查看单个集群成本</h2>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/cluster-cost/cluster-3_hu41d2df885f0270c87d1ee7b4ec2c5e92_144315_900x0_resize_catmullrom_3.png" width="900" height="417">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
单个集群成本
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8aaf6cb4995450b6fc76e7ad887b0eb3">2.4 - 查看节点成本</h1>
    <div class="lead">描述了如何查看和分析节点整体成本.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Wisecost提供了云原生应用成本监控、管理和优化能力。本文档描述如何查看节点成本及其各项指标含义。</p>

</div>

<h2 id="查看节点整体成本">查看节点整体成本</h2>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/node-cost/node-1_hu75571daf753b1528af155b01a3a46732_216015_900x0_resize_catmullrom_3.png" width="900" height="387">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
节点整体成本
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>








<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/node-cost/node-2_hud14bc57c8e8b54563bbb85fde7d79e40_218471_900x0_resize_catmullrom_3.png" width="900" height="412">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
节点整体成本分解
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<h2 id="查看单个节点成本">查看单个节点成本</h2>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/node-cost/node-3_hu68f4c02bdee6f069f5706d794bd1b072_255353_900x0_resize_catmullrom_3.png" width="900" height="418">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
单节点成本
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-aea197f3575cb0df1ded1df55290950c">2.5 - 查看应用成本</h1>
    <div class="lead">描述如何查看和分析应用成本.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Wisecost提供了云原生应用成本监控、管理和优化能力。本文档描述如何查看和分析应用成本.</p>

</div>

<h2 id="查看名称空间成本">查看名称空间成本</h2>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/cost/namespace-1_hud84a5484e7411474683c506fc18d85bf_185074_900x0_resize_catmullrom_3.png" width="900" height="323">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
名称空间累计成本及利用率
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>








<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/cost/namespace-2_hu0683868b0a89a61f2790babad8579e94_272727_900x0_resize_catmullrom_3.png" width="900" height="260">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
名称空间分时成本
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<h2 id="查看产品成本">查看产品成本</h2>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/cost/product-1_hue482c5ef76f206dad3043c87478904a0_168742_900x0_resize_catmullrom_3.png" width="900" height="298">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
产品累计成本及利用率
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>








<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/cost/product-2_hudcb30c2598ce67584624d0fbc71b184a_155549_900x0_resize_catmullrom_3.png" width="900" height="262">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
产品分时成本
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<h2 id="自定义查询">自定义查询</h2>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/wisecost/cost/custom-1_hubb8eef4e201ee755282e6123f8f7c76d_282976_900x0_resize_catmullrom_3.png" width="900" height="456">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
名称空间分时成本
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0d313d792f0ef08d3b1695b67d8bddea">2.6 - 成本优化</h1>
    <div class="lead">描述了基于Wisecost内置策略，优化成本的过程.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Wisecost提供了云原生应用成本监控、管理和优化能力。本文档描述了基于Wisecost内置策略，优化成本的过程.</p>

</div>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-eb8dcf79b1b7f912ed56305be6f0297f">2.7 - 开发手册</h1>
    <div class="lead">一站式云原生应用成本监控、管理和优化平台.</div>
	

<div class="pageinfo pageinfo-primary">
<p>本部分包括Wisecost API相关接口使用说明。详细接口文档请参见：API URL</p>

</div>


</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-7498afe225cc47a707df513f40a91ac6">2.7.1 - API文档</h1>
    <div class="lead">一站式云原生应用成本监控、管理和优化平台API文档。</div>
	

<div class="pageinfo pageinfo-primary">
<p>本部分描述了Wisecsost API相关文档。</p>

</div>

<h2 id="概述">概述</h2>
<p>Wisecost API主要为集群、节点和容器提供多维度的成本查询和成本分解查询。</p>
<p>Wisecost API主要通过HTTP的方式进行方式。其API文档请参见链接： 用户可通过Swagger Editor/Codegen等工具生成客户端代码。</p>
<p>详见导入集群<a href="/docs/wisecost/import-aliyun">导入阿里云集群</a></p>
<p>API接口文档下载地址如下：<a href="/api/v1/openapi.json">Wisecost API接口</a></p>
<h2 id="通用参数描述">通用参数描述</h2>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>说明</th>
<th>默认值</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>window</td>
<td>查询窗口范围</td>
<td>无</td>
<td>1. 时间范围格式：主要用于描述绝对时间，例如2023-05-24T18%3A00%3A00%2B08%3A00%2C2023-05-25T00%3A00%3A00%2B08%3A00 <br>2. 时间表达式：1d, 1h，lastday，lastweek等</td>
</tr>
<tr>
<td>align</td>
<td>时间对齐，主要用于时间表达式，对当前时间进行截断，将截断后的时间作为当前时间进行时间表达式计算，当截断后的时间不变化时，其查询结果是不变化的。</td>
<td>1m</td>
<td>例如1h，1m</td>
</tr>
<tr>
<td>step</td>
<td>查询步长，此值必须小于或等于时间窗口范围</td>
<td>查询窗口window的范围</td>
<td>1d</td>
</tr>
<tr>
<td>resolution</td>
<td>Prometheus分辨率</td>
<td>2m</td>
<td>2m</td>
</tr>
<tr>
<td>aggregate</td>
<td>聚合参数，集群成本、节点成本和容器成本聚合参数取值不同</td>
<td>无</td>
<td>1. cluster: 按集群聚合。<br/>2. namespace: 按名称空间聚合<br/> 3. cluster,namespace: 按集群和名称空间进行聚合</td>
</tr>
<tr>
<td>filter</td>
<td>过滤参数，集群成本、节点成本和容器成本过滤参数取值不同</td>
<td>无</td>
<td></td>
</tr>
</tbody>
</table>
<p>所有参数均采用URL编码。</p>
<h2 id="集群成本api">集群成本API</h2>
<h3 id="查询集群成本">查询集群成本</h3>
<p>端点：/api/cluster</p>
<h4 id="实例1查询集群test1过去1个小时的成本">实例1：查询集群<code>test1</code>过去1个小时的成本</h4>
<p>请求：</p>
<pre tabindex="0"><code>${HOST}/api/cluster/window=1h&amp;filter=cluster:test1`
</code></pre><p>响应中包括查询所在时间窗口、CPU成本、内存、存储和网络的相应成本。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;test1&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;window&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-05-04T14:37:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-05-04T15:37:00Z&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-05-04T14:37:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-05-04T15:37:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuCoreHours&#34;</span>: <span style="color:#ae81ff">0.1022572407401936</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuCoreUsageAverage&#34;</span>: <span style="color:#ae81ff">0.0511286203700968</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuUsage&#34;</span>: <span style="color:#ae81ff">0.004876883689704125</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuLimitCost&#34;</span>: <span style="color:#ae81ff">0.09538461343964662</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.00024035371519684083</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuActualCost&#34;</span>: <span style="color:#ae81ff">0.00024035371519684083</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryByteHours&#34;</span>: <span style="color:#ae81ff">1970868694.0327873</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryBytesUsageAverage&#34;</span>: <span style="color:#ae81ff">1970868694.0327873</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryUsage&#34;</span>: <span style="color:#ae81ff">0.029179973608599755</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryLimitCost&#34;</span>: <span style="color:#ae81ff">0.06358974229309775</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.0014381140729231169</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryActualCost&#34;</span>: <span style="color:#ae81ff">0.0014381140729231169</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageByteHours&#34;</span>: <span style="color:#ae81ff">12.501899906846337</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;networkUsage&#34;</span>: <span style="color:#ae81ff">0.0523391093881065</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;networkDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.0026294713433894375</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;networkActualCost&#34;</span>: <span style="color:#ae81ff">0.0026294713433894375</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h4 id="实例2查询集群2023年4月份的成本以1天为步长">实例2：查询集群2023年4月份的成本，以1天为步长</h4>
<p>请求如下所示，其中， <code>window=2023-04-01T00%3A00%3A00%2B08%3A00%2C2023-04-30T23%3A59%3A59%2B08%3A00</code>是 <code>window=2023-04-01T00:00:00+08:00,2023-05-01T00:00:00+08:00</code>的URL编码，<code>step=1d</code>表示步长是1天。</p>
<pre tabindex="0"><code>${HOST}/api/cluster?window=2023-04-01T00%3A00%3A00%2B08%3A00%2C2023-04-30T23%3A59%3A59%2B08%3A00&amp;step=1d
</code></pre><p>响应中包括每天的成本。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">...</span>
</span></span><span style="display:flex;"><span>     {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;test1&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;window&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-04-16T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-04-17T00:00:00+08:00&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-04-16T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-04-17T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuCoreHours&#34;</span>: <span style="color:#ae81ff">2.39842986589827</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuCoreUsageAverage&#34;</span>: <span style="color:#ae81ff">0.049967288872880634</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuUsage&#34;</span>: <span style="color:#ae81ff">0.114386652810405</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuLimitCost&#34;</span>: <span style="color:#ae81ff">2.289230722551519</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.0056374641515348455</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuActualCost&#34;</span>: <span style="color:#ae81ff">0.0056374641515348455</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryByteHours&#34;</span>: <span style="color:#ae81ff">46971476835.98894</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryBytesUsageAverage&#34;</span>: <span style="color:#ae81ff">1957144868.1662054</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryUsage&#34;</span>: <span style="color:#ae81ff">0.6954428057947072</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryLimitCost&#34;</span>: <span style="color:#ae81ff">1.5261538150343459</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.034274399947769485</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryActualCost&#34;</span>: <span style="color:#ae81ff">0.034274399947769485</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageByteHours&#34;</span>: <span style="color:#ae81ff">296.0557048723639</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageLimitCost&#34;</span>: <span style="color:#ae81ff">0.38230305987834323</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageUsage&#34;</span>: <span style="color:#ae81ff">0.11789896027827546</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.005920212076830545</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageActualCost&#34;</span>: <span style="color:#ae81ff">0.005920212076830545</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;networkUsage&#34;</span>: <span style="color:#ae81ff">1.2561386253145561</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;networkDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.0631073122413465</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;networkActualCost&#34;</span>: <span style="color:#ae81ff">0.0631073122413465</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;test1&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;window&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-04-17T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-04-18T00:00:00+08:00&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-04-17T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-04-18T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuCoreHours&#34;</span>: <span style="color:#ae81ff">2.4017858534989167</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuCoreUsageAverage&#34;</span>: <span style="color:#ae81ff">0.05003720528122743</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuUsage&#34;</span>: <span style="color:#ae81ff">0.11454670760040295</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuLimitCost&#34;</span>: <span style="color:#ae81ff">2.289230722551519</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.005645352337076829</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuActualCost&#34;</span>: <span style="color:#ae81ff">0.005645352337076829</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryByteHours&#34;</span>: <span style="color:#ae81ff">46969022844.09973</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryBytesUsageAverage&#34;</span>: <span style="color:#ae81ff">1957042618.5041554</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryUsage&#34;</span>: <span style="color:#ae81ff">0.6954064728726917</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryLimitCost&#34;</span>: <span style="color:#ae81ff">1.5261538150343459</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.03427260930576406</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryActualCost&#34;</span>: <span style="color:#ae81ff">0.03427260930576406</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageByteHours&#34;</span>: <span style="color:#ae81ff">296.51888150455557</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageLimitCost&#34;</span>: <span style="color:#ae81ff">0.38230305987834323</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageUsage&#34;</span>: <span style="color:#ae81ff">0.11808341219884944</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.005929474198270796</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageActualCost&#34;</span>: <span style="color:#ae81ff">0.005929474198270796</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;networkUsage&#34;</span>: <span style="color:#ae81ff">1.2561386253145561</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;networkDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.0631073122413465</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;networkActualCost&#34;</span>: <span style="color:#ae81ff">0.0631073122413465</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">...</span>
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h3 id="查询集群成本分解">查询集群成本分解</h3>
<p>端点：/api/cluster/breakdown</p>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="节点成本api">节点成本API</h2>
<h3 id="查询节点成本">查询节点成本</h3>
<p>示例：查询2023年5月21日的成本，同时以集群维度进行聚合</p>
<p>查询请求如下，<code>aggregate=cluster</code>表示以集群的维度进行对成本进行聚合。</p>
<pre tabindex="0"><code>${HOST}/api//node?window=2023-05-21T00%3A00%3A00%2B08%3A00%2C2023-05-22T00%3A00%3A00%2B08%3A00&amp;aggregate=cluster&amp;step=1d
</code></pre><p>响应如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;test1&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;window&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-05-21T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-05-22T00:00:00+08:00&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-05-21T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-05-22T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuCoreHours&#34;</span>: <span style="color:#ae81ff">10191.999645820562</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuCoreUsageAverage&#34;</span>: <span style="color:#ae81ff">11.849338429255141</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuUsage&#34;</span>: <span style="color:#ae81ff">1398.9775682219886</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuLimitCost&#34;</span>: <span style="color:#ae81ff">15249.214211755743</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuDiscountedCost&#34;</span>: <span style="color:#ae81ff">381.60351525705556</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpuActualCost&#34;</span>: <span style="color:#ae81ff">28.957126887351876</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryByteHours&#34;</span>: <span style="color:#ae81ff">75542324732065.4</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryBytesUsageAverage&#34;</span>: <span style="color:#ae81ff">3204178398788.0137</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryUsage&#34;</span>: <span style="color:#ae81ff">1112.9733948614235</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryLimitCost&#34;</span>: <span style="color:#ae81ff">3346.309071231689</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryDiscountedCost&#34;</span>: <span style="color:#ae81ff">319.71875931585464</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;memoryActualCost&#34;</span>: <span style="color:#ae81ff">30.702726624974325</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;gpuLimitCost&#34;</span>: <span style="color:#ae81ff">8510.219221802927</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageByteHours&#34;</span>: <span style="color:#ae81ff">325888.80723224004</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageLimitCost&#34;</span>: <span style="color:#ae81ff">930.4165497908426</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageUsage&#34;</span>: <span style="color:#ae81ff">260.05386312757275</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageDiscountedCost&#34;</span>: <span style="color:#ae81ff">5527.065766508991</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;storageActualCost&#34;</span>: <span style="color:#ae81ff">589.8840784941499</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h3 id="查询节点成本分解">查询节点成本分解</h3>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="容器成本api">容器成本API</h2>
<h3 id="查询容器成本">查询容器成本</h3>
<p>端点：/api/cost</p>
<h4 id="示例1查询过去1小时的容器成本">示例1：查询过去1小时的容器成本</h4>
<p>请求如下：</p>
<pre tabindex="0"><code>${HOST}/api/cost?window=1h
</code></pre><p>响应如下，其中，<code>test1/kube-system/kube-state-metrics-678c95bd66-zpxhr/kube-state-metrics/d222ea5b968281735981465d393dc140fae2fa6c82bca4ce7b0551094542b6cc</code>为容器键，可唯一定位集群中的容器，其集群是<code>test1</code>，名称空间是<code>kube-system</code>，Pod是<code>kube-state-metrics-678c95bd66-zpxhr</code>，容器名为<code>kube-state-metrics</code>, 容器ID是<code>d222ea5b968281735981465d393dc140fae2fa6c82bca4ce7b0551094542b6cc</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;test1/kube-system/kube-state-metrics-678c95bd66-zpxhr/kube-state-metrics/d222ea5b968281735981465d393dc140fae2fa6c82bca4ce7b0551094542b6cc&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;window&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-05-21T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-05-22T00:00:00+08:00&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-05-21T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-05-22T00:00:00+08:00&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;cpuCoreHours&#34;</span>: <span style="color:#ae81ff">0.0006655009861111111</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;cpuCoreUsageAverage&#34;</span>: <span style="color:#ae81ff">0.0006655009861111111</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;cpuUsage&#34;</span>: <span style="color:#ae81ff">0.00018150026893939394</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;memoryByteHours&#34;</span>: <span style="color:#ae81ff">30465849.806451615</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;memoryByteUsageAverage&#34;</span>: <span style="color:#ae81ff">30465849.806451615</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;memoryUsage&#34;</span>: <span style="color:#ae81ff">0.0025794121526902724</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;networkTransferBytes&#34;</span>: <span style="color:#ae81ff">155958130.4459916</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;networkReceiveBytes&#34;</span>: <span style="color:#ae81ff">7025546.93011364</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;networkUsage&#34;</span>: <span style="color:#ae81ff">0.12143230242737027</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">]</span>
</span></span></code></pre></div><h4 id="示例2查询过去1小时的成本并按名称空间聚合">示例2：查询过去1小时的成本并按名称空间聚合</h4>
<p>请求如下，<code>aggregate=cluster,namespace</code>表示按照集群<code>cluster</code>和名称空间<code>namespace</code>两个维度聚合。</p>
<pre tabindex="0"><code>${HOST}/api/cost?window=1h&amp;aggregate=cluster,namespace
</code></pre><p>响应如下，以键值对形式表示，其中<code>test1/default</code>和<code>test1/wiseinf-system</code>为聚合后的集群和名称空间构成（例如，<code>test1/wiseinf-system</code>表示集群是<code>test1</code>，名称空间是<code>wiseinf-system</code>），其值中为查询时间窗口以及CPU、内存、存储、网络的成本。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;test1/default&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;window&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-05-16T03:12:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-05-17T03:12:00Z&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-05-16T03:12:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-05-17T03:12:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;cpuCoreHours&#34;</span>: <span style="color:#ae81ff">110.37890957267645</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;cpuCoreUsageAverage&#34;</span>: <span style="color:#ae81ff">4.599121232194852</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;cpuUsage&#34;</span>: <span style="color:#ae81ff">14.534367730634747</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;cpuDiscountedCost&#34;</span>: <span style="color:#ae81ff">5.087019014821965</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;memoryByteHours&#34;</span>: <span style="color:#ae81ff">855736964377.1166</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;memoryBytesUsageAverage&#34;</span>: <span style="color:#ae81ff">35655706849.04652</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;memoryUsage&#34;</span>: <span style="color:#ae81ff">16.161382539369775</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;memoryDiscountedCost&#34;</span>: <span style="color:#ae81ff">5.656134320229584</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;storageByteHours&#34;</span>: <span style="color:#ae81ff">71415669997.57649</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;storageBytesUsageAverage&#34;</span>: <span style="color:#ae81ff">2975652916.565687</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;storageUsage&#34;</span>: <span style="color:#ae81ff">0.03335223778525009</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;storageDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.8787704581851865</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;networkTransferBytes&#34;</span>: <span style="color:#ae81ff">1719133463220.9966</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;networkReceiveBytes&#34;</span>: <span style="color:#ae81ff">5342028979687.877</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;networkUsage&#34;</span>: <span style="color:#ae81ff">1436.257368277605</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;test1/wiseinf-system&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;window&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-05-16T03:12:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-05-17T03:12:00Z&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;2023-05-16T03:12:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#e6db74">&#34;2023-05-17T03:12:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;cpuCoreHours&#34;</span>: <span style="color:#ae81ff">0.473797171047238</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;cpuCoreUsageAverage&#34;</span>: <span style="color:#ae81ff">0.01974154879363492</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;cpuUsage&#34;</span>: <span style="color:#ae81ff">0.08657493662239153</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;cpuDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.030290465709544856</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;memoryByteHours&#34;</span>: <span style="color:#ae81ff">74778025427.29366</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;memoryBytesUsageAverage&#34;</span>: <span style="color:#ae81ff">3115751059.4705696</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;memoryUsage&#34;</span>: <span style="color:#ae81ff">1.4158569605645943</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;memoryDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.4953997082063547</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;storageByteHours&#34;</span>: <span style="color:#ae81ff">1515201139.4631371</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;storageBytesUsageAverage&#34;</span>: <span style="color:#ae81ff">63133380.81096403</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;storageUsage&#34;</span>: <span style="color:#ae81ff">0.0011343806651708506</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;storageDiscountedCost&#34;</span>: <span style="color:#ae81ff">0.06193233856164118</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;networkTransferBytes&#34;</span>: <span style="color:#ae81ff">11732534100151.451</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;networkReceiveBytes&#34;</span>: <span style="color:#ae81ff">15567186905652.652</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;networkUsage&#34;</span>: <span style="color:#ae81ff">7666.392896312047</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ac38a1975f478ccb8a2806eda6f684b8">2.7.2 - API接口参考</h1>
    <div class="lead">成本管理API接口参考。</div>
	
<!DOCTYPE html>
<html lang="ZH-cn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="SwaggerUI"
  />
  <title>Wisecost API接口</title>
  <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui.css" />
</head>
<body>
<div id="swagger-ui"></div>
<script src="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui-bundle.js" crossorigin></script>
<script>
  window.onload = () => {
    window.ui = SwaggerUIBundle({
      url: '/api/v1/openapi.json',
      dom_id: '#swagger-ui',
    });
  };
</script>
</body>
</html>
</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-01e1381825635108c13ad0b6aeb191c7">3 - Ruyi：云原生集群扩缩容引擎</h1>
    <div class="lead">Ruyi：云原生集群扩缩容引擎.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Ruyi提供了自动化智能化云原生集群扩缩容引擎.</p>

</div>

<p>Ruyi提供了自动化智能化云原生集群扩缩容引擎，主要功能包括：</p>
<ul>
<li>自动扩缩容：提供基于Pod Request的自动扩缩容。</li>
<li>虚拟容量：通过自动化智能化的技术对节点容量进行弹性伸缩，支持尽可能的调度更多的Pod。</li>
<li>多云支持：支持AWS、阿里云，更多云服务商正在集成中。</li>
<li>监控管理：提供多维度的监控指标数据。</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cc7d60fb60c1ccaac59ce2ceb1c8f961">3.1 - 安装部署</h1>
    <div class="lead">描述了安装Ruyi：云原生集群扩缩容引擎的详细步骤.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Ruyi：云原生集群扩缩容引擎。</p>

</div>

<p>正在更新中，请稍后。</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-802a1bd58ef9bdae22313856241b0f7f">3.2 - 自动扩缩容</h1>
    <div class="lead">描述了安装Ruyi：云原生集群扩缩容引擎的详细步骤.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Ruyi：云原生集群扩缩容引擎。</p>

</div>

<h2 id="扩缩容原理">扩缩容原理</h2>
<p>正在更新中，请稍后。</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9bc01fd7dcd71c629d9b0497e453387a">3.3 - 虚拟容量</h1>
    <div class="lead">描述了Ruyi：云原生集群扩缩容虚拟容量的原理和应用流程.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Ruyi：云原生集群扩缩容引擎虚拟容量基于对节点请求量、使用量等的分析，动态扩展节点容量，支持用户调度更多的应用，同时尽量保障稳定性。</p>

</div>

<h2 id="虚拟容量概述">虚拟容量概述</h2>
<p>虚拟容量可在特定条件下，将节点容量增长为其原容量3倍（甚至更多），从而支持在节点上调度更多的Pod（应用）。</p>
<p>通过虚拟容量，用户可以显著节省其IT成本。</p>
<h2 id="虚拟容量原理">虚拟容量原理</h2>
<p>要理解虚拟容量，首先要了解Kuberente的调度机制。在Kubernetes中，调度是为应用的Pod指定其运行节点的过程。Pod在被调度时一般都指定其资源需求，其中对于CPU资源，会指定其Request和Limit属性（后面称为<code>CPU Request</code>和<code>CPU Limit</code>）。对于Kubernetes中的节点，一般都有容量属性，容量属性分为两种：1，<code>Capacity</code>：节点的容量上限；2，<code>Allocatable</code>：节点可分配容量上限，会在节点容量上限的基础上去除系统用的资源以及一些预留资源而得到。Kubernetes调度时，在容量方面，会主要考虑Pod的<code>CPU Request</code>和节点的<code>Allocatable</code>是否匹配。匹配的含义是指：当前节点<code>Allocatable</code>的剩余容量，应当大于或等于当前Pod的<code>CPU Request</code>。</p>
<p>当节点<code>Allocatable</code>的剩余容量小于当前Pod的<code>CPU Request</code>时，则不可将此Pod调度到此节点。此时，调度会考虑其他节点，当所有节点都不满足要求时，会直接将Pod挂起，等待有合适的资源再调度。当Pod挂起时，部分Kubernetes提供商提供了集群扩缩容机制，当用户启用此机制时，会在集群中扩展新的节点，将此Pod调度到新的节点中。</p>
<p>事实上，当节点<code>Allocatable</code>的剩余容量小于当前Pod的<code>CPU Request</code>时，可能当前节点上的使用量较低，节点上实际剩余资源要大于当前Pod的<code>CPU Request</code>。从理论上来说，可以将该Pod调度到该节点上。虚拟容量提供了一种机制，可以在特定条件下扩展节点的<code>Allocatable</code>值，让调度认为当前节点<code>Allocatable</code>的剩余容量仍然大于或等于当前Pod的<code>CPU Request</code>，从而将Pod调度到该节点。</p>
<p>通过扩展节点的虚拟容量，可以显著节约IT成本，特别是在开发、测试等资源利用率较低的场合。</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">注意</h4>

    节点上调度过多Pod可能对节点和应用的稳定性有一定的影响。因此，需根据实际状况设置合适的值，同时利用一些平衡的调度算法。

</div>

<h2 id="案例">案例</h2>
<p>下面我们以一个案例说明如何虚拟容量。</p>
<p>案例中，节点资源为4核8G，我们通过<code>kubectl apply -f nginx.yaml</code>将在其上调度4个Nginx Pod（Pod的<code>CPU Request</code>是2核），如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.14.2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">2</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">500Mi</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">1024Mi</span>
</span></span></code></pre></div><p>通过<code>kubectl get po</code>查看状态，可以看到有一个Pod处于Pending状态，说明当前节点的<code>Allocatable</code>无法满足<code>nginx-deployment</code>的资源需求。</p>
<pre tabindex="0"><code>********:~/src/nginx$ kubectl get po
NAME                                READY   STATUS    RESTARTS   AGE
nginx-deployment-7dc45fbc49-5k9gd   1/1     Running   0          6s
nginx-deployment-7dc45fbc49-gpq77   1/1     Running   0          2d14h
nginx-deployment-7dc45fbc49-snj6k   0/1     Pending   0          6s
nginx-deployment-7dc45fbc49-v4xsq   1/1     Running   0          41h
</code></pre><p>等待一段时间后，再执行通过<code>kubectl get po</code>查看状态，可以看到所有的Pod都已经运行在节点上。</p>
<pre tabindex="0"><code>********:~/src/nginx$ kubectl get po
NAME                                READY   STATUS    RESTARTS   AGE
nginx-deployment-7dc45fbc49-5k9gd   1/1     Running   0          23m
nginx-deployment-7dc45fbc49-gpq77   1/1     Running   0          2d14h
nginx-deployment-7dc45fbc49-snj6k   1/1     Running   0          23m
nginx-deployment-7dc45fbc49-v4xsq   1/1     Running   0          41h

WUYING\wiseinf_131347202297@6w49f6pbp2eeds8:~/src/nginx$ kubectl describe node 6w49f6pbp2eeds8
Name:               6w49f6pbp2eeds8
Roles:              control-plane,master
Labels:             beta.kubernetes.io/arch=amd64
                    beta.kubernetes.io/os=linux
                    kubernetes.io/arch=amd64
                    kubernetes.io/hostname=6w49f6pbp2eeds8
                    ...
Annotations:        virtualcapacity.wiseinf.com/allocatable: 10200
                    virtualcapacity.wiseinf.com/last-decrease-timestamp: 2023-08-31T10:34:57+08:00
                    virtualcapacity.wiseinf.com/last-increase-timestamp: 2023-08-31T10:37:57+08:00
                    virtualcapacity.wiseinf.com/ratio: 3.000
                    ...
CreationTimestamp:  Fri, 25 Aug 2023 16:23:13 +0800
Taints:             &lt;none&gt;
Unschedulable:      false
Lease:
  HolderIdentity:  6w49f6pbp2eeds8
  AcquireTime:     &lt;unset&gt;
  RenewTime:       Thu, 31 Aug 2023 10:52:51 +0800
Conditions:
  Type                 Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message
  ----                 ------  -----------------                 ------------------                ------                       -------
  ...
Addresses:
  InternalIP:  198.19.3.220
  Hostname:    6w49f6pbp2eeds8
Capacity:
  cpu:                4
  ephemeral-storage:  82437788Ki
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  memory:             7784472Ki
  pods:               110
Allocatable:
  cpu:                10200m
  ephemeral-storage:  75974665296
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  memory:             7682072Ki
  pods:               110
System Info:
  Machine ID:                 20220524174107033216151293301385
  System UUID:                eddd0796-49a7-4094-afd0-961b8a826663
  Boot ID:                    1b9bde42-fadf-4e83-8af8-3f6cc44a0b99
  Kernel Version:             5.4.0-113-generic
  OS Image:                   Ubuntu 20.04.4 LTS
  Operating System:           linux
  Architecture:               amd64
  Container Runtime Version:  docker://24.0.5
  Kubelet Version:            v1.22.17
  Kube-Proxy Version:         v1.22.17
PodCIDR:                      10.244.0.0/24
PodCIDRs:                     10.244.0.0/24
Non-terminated Pods:          (16 in total)
  Namespace                   Name                                       CPU Requests  CPU Limits  Memory Requests  Memory Limits  Age
  ---------                   ----                                       ------------  ----------  ---------------  -------------  ---
  default                     nginx-deployment-7dc45fbc49-5k9gd          2 (19%)       2 (19%)     500Mi (6%)       1Gi (13%)      39m
  default                     nginx-deployment-7dc45fbc49-gpq77          2 (19%)       2 (19%)     500Mi (6%)       1Gi (13%)      2d15h
  default                     nginx-deployment-7dc45fbc49-snj6k          2 (19%)       2 (19%)     500Mi (6%)       1Gi (13%)      39m
  default                     nginx-deployment-7dc45fbc49-v4xsq          2 (19%)       2 (19%)     500Mi (6%)       1Gi (13%)      41h
  ...
Allocated resources:
  (Total limits may be over 100 percent, i.e., overcommitted.)
  Resource           Requests          Limits
  --------           --------          ------
  cpu                9650m (94%)       11100m (108%)
  memory             3901239040 (49%)  7595365Ki (98%)
  ephemeral-storage  0 (0%)            0 (0%)
  hugepages-1Gi      0 (0%)            0 (0%)
  hugepages-2Mi      0 (0%)            0 (0%)
Events:              &lt;none&gt;
</code></pre><p>从监控指标<code>kube_node_status_allocatable</code>中，可以看到节点<code>6w49f6pbp2eeds8</code>的可分配CPU核数<code>Allocatable</code>一直在增长，直到<strong>10.2</strong>核。同时，从监控指标<code>kube_node_status_capacity</code>中可以到到该节点的容量一直是<strong>4</strong>核。可以看到，节点<code>6w49f6pbp2eeds8</code>的CPU容量扩展了大概2.55倍。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/ruyi/virtualcapacity/node-allocatable_hu31e328ed3036e9882644702f546ce89e_132311_900x0_resize_catmullrom_3.png" width="900" height="433">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
节点的CPU Allocatable
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>








<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/ruyi/virtualcapacity/node-capacity_hub4e37652f76e254a84e610246b6d8089_55563_900x0_resize_catmullrom_3.png" width="900" height="434">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
节点的CPU Capacity
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>从监控指标<code>ruyi_node_request_sum</code>中，可以看到节点<code>6w49f6pbp2eeds8</code>上的Pod的CPU请求总和一直在增长，直到<code>nginx-deployment</code>的4个副本调度到节点上并运行。</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/zh-cn/docs/ruyi/virtualcapacity/node-cpu-request-sum_huf30fc5671e2b9ef5baf3f476ab942257_107595_900x0_resize_catmullrom_3.png" width="900" height="457">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
节点的CPU请求总和
<small class="text-muted"><br/>Wiseinf Inc.</small></p>
	</figcaption>
	
</figure>

<p>通过这个案例，可知若能合理利用虚拟容量，将可以节省大量CPU成本。</p>
<p>想了解如何为节点池配置虚拟容量，请参考<a href="/docs/ruyi/configuration/nodegroup/#%E8%99%9A%E6%8B%9F%E5%AE%B9%E9%87%8F%E9%85%8D%E7%BD%AE">虚拟容量配置</a></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1d9cdd8985d61af6eb19f64872c6238c">3.4 - 配置</h1>
    <div class="lead">描述Ruyi：云原生集群扩缩容引擎的配置.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Ruyi：云原生集群扩缩容引擎。</p>

</div>

<h2 id="配置ruyi云原生集群扩缩容引擎">配置Ruyi：云原生集群扩缩容引擎</h2>
<p>Ruyi：云原生集群扩缩容引擎提供了自动扩缩容和虚拟容量两大特性。可单独使用某项特性或同时使用两项特性。</p>
<p>可通过命令行参数<code>--features</code>指定。</p>
<p>下面描述单独配置自动扩缩容特性或者虚拟容量特性的主要配置参数。</p>
<h3 id="配置自动扩缩容特性">配置自动扩缩容特性</h3>
<pre tabindex="0"><code>$ ruyi --features=Autoscaling --cloud-provider=alicloud --loglevel=debug --kubeconfig=/opt/ruyi/config/kubeconfig --config=/opt/ruyi/config/config.yaml
</code></pre><h3 id="配置虚拟容量特性">配置虚拟容量特性</h3>
<pre tabindex="0"><code>$ ruyi --features=VirtualCapacity --cloud-provider=alicloud --loglevel=debug --kubeconfig=/opt/ruyi/config/kubeconfig --config=/opt/ruyi/config/config.yaml --webhook-cert-dir=/opt/ruyi/certs/
</code></pre><p>虚拟容量特性涉及到虚拟容量控制器以及Webhook，可通过参数分别控制。</p>
<p>例如，可通过如下命令单独启用虚拟容量控制器：</p>
<pre tabindex="0"><code>$ ruyi --features=VirtualCapacity --cloud-provider=alicloud --loglevel=debug --kubeconfig=/opt/ruyi/config/kubeconfig --config=/opt/ruyi/config/config.yaml --enable-virtual-capacity-controller=true  --enable-webhook=false
      
</code></pre><p>或者，通过如下命令单独启动Webhook：</p>
<pre tabindex="0"><code>$ ruyi --features=VirtualCapacity --cloud-provider=alicloud --loglevel=debug --kubeconfig=/opt/ruyi/config/kubeconfig --config=/opt/ruyi/config/config.yaml
--enable-virtual-capacity-controller=false  --enable-webhook=true --webhook-cert-dir=/opt/ruyi/certs/
</code></pre><p>在配置Webhook时，必须指定<code>MutatingWebhookConfiguration</code>，如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">admissionregistration.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">MutatingWebhookConfiguration</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wiseinf-webhooks</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">webhooks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ruyi.wiseinf-system.svc</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">admissionReviewVersions</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clientConfig</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">caBundle</span>: <span style="color:#ae81ff">&lt;CA Bundle&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ruyi</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">wiseinf-system</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/mutate--v1-node</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">apiGroups</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">apiVersions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">operations</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#e6db74">&#34;UPDATE&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">nodes/status</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scope</span>: <span style="color:#e6db74">&#34;Cluster&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failurePolicy</span>: <span style="color:#ae81ff">Ignore</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sideEffects</span>: <span style="color:#ae81ff">None</span>
</span></span></code></pre></div><blockquote>
<p>注意：必须正确指定<code>MutatingWebhookConfiguration</code>的<code>caBundle</code>，否则Webhook不会生效。</p>
</blockquote>
<h3 id="环境变量">环境变量</h3>
<p>使用自动扩缩容特性特性时，需通过环境变量提供云服务商的相关信息。</p>
<p>若使用阿里云，则需通过环境变量配置阿里云的AccessKey及其Region。</p>
<table>
<thead>
<tr>
<th>环境变量名称</th>
<th>说明</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>ALIBABA_CLOUD_ACCESS_KEY_ID</td>
<td>阿里云AccessKeyID</td>
<td>无默认值</td>
</tr>
<tr>
<td>ALIBABA_CLOUD_ACCESS_KEY_SECRET</td>
<td>阿里云AccessKeySecret</td>
<td>无默认值</td>
</tr>
<tr>
<td>ALIBABA_CLOUD_REGION_ID</td>
<td>阿里云集群所在地域ID</td>
<td>cn-hangzhou</td>
</tr>
</tbody>
</table>
<p>若使用AWS，则需通过环境变量配置AWS的的AccessKey。</p>
<table>
<thead>
<tr>
<th>环境变量名称</th>
<th>说明</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>AWS_ACCESS_KEY_ID 或 AWS_ACCESS_KEY</td>
<td>AWS云AccessKeyID</td>
<td>无默认值</td>
</tr>
<tr>
<td>AWS_SECRET_ACCESS_KEY 或 AWS_SECRET_KEY</td>
<td>AWS云AccessKeySecret</td>
<td>无默认值</td>
</tr>
<tr>
<td>AWS_ASSUME_ROLE_ARN</td>
<td>AWS云ASSUME_ROLE_ARN</td>
<td>无默认值</td>
</tr>
</tbody>
</table>
<p>详细配置项，请参考：</p>
<ul>
<li><a href="/docs/ruyi/configuration/command-line/">命令行配置</a></li>
<li><a href="/docs/ruyi/configuration/nodegroup/">节点组配置</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-311560d092771780a32c6c35dc00ad8c">3.4.1 - 节点组配置参数</h1>
    <div class="lead">描述了Ruyi：云原生集群扩缩容引擎的节点组配置参数.</div>
	

<div class="pageinfo pageinfo-primary">
<p>Ruyi：云原生集群扩缩容引擎配置。</p>

</div>

<h2 id="节点组配置参数概述">节点组配置参数概述</h2>
<p>引擎必须依赖于节点组配置参数才能运行。节点组配置参数通过命令行参数<code>--config</code>来制定配置文件位置。例如：<code>--config=/etc/ruyi/config.yaml</code></p>
<p>配置文件格式为YAML格式，示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">nodeGroups</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;default-pool&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodeGroupId</span>: <span style="color:#e6db74">&#34;np1234567890&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">spot_type</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#ae81ff">cpu</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">dryRun</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enableAutoscaling</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">autoscaling</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">minNodes</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxNodes</span>: <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enableScaleDown</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">scaleUp</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">threshold</span>: <span style="color:#ae81ff">0.70</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scaleOnPodPending</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">silencePeriod</span>: <span style="color:#ae81ff">2m</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">scaleDown</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">threshold</span>: <span style="color:#ae81ff">0.40</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">softDeleteGracePeriod</span>: <span style="color:#ae81ff">1m</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hardDeleteGracePeriod</span>: <span style="color:#ae81ff">10m</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">maxNodeRemovalRate</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">taintEffect</span>: <span style="color:#ae81ff">NoExecute</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enableVirtualCapacity</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">virtualCapacity</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">prometheusAddress</span>: <span style="color:#e6db74">&#34;http://prometheus:9090&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">prometheusWindow</span>: <span style="color:#e6db74">&#34;2m&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">isThanos</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">thanosClusterKey</span>: <span style="color:#ae81ff">cluster</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">thanosClusterValue</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">reservationRatio</span>: <span style="color:#ae81ff">0.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">increaseSilencePeriod</span>: <span style="color:#ae81ff">2m</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">decreaseSilencePeriod</span>: <span style="color:#ae81ff">2m</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">stabilityWindow</span>: <span style="color:#ae81ff">5m</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">tolerance</span>: <span style="color:#ae81ff">0.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpuMaxUsage</span>: <span style="color:#ae81ff">0.7</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxValue</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">minValue</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resourceReservation</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kubeReserved</span>: <span style="color:#ae81ff">200m</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">SystemReserved</span>: <span style="color:#ae81ff">200m</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">SystemReservedPercentage</span>: <span style="color:#ae81ff">0.1</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">alicloud</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">clusterId</span>: <span style="color:#ae81ff">c1234567890</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">lifecycle</span>: <span style="color:#ae81ff">spot</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resourceTagging</span>: <span style="color:#66d9ef">false</span>
</span></span></code></pre></div><h2 id="配置参数">配置参数</h2>
<h3 id="name"><code>name</code></h3>
<p>参数<code>name</code>是引擎运行过程中使用的名称，可用于输出友好的日志信息等。不同的节点组名称必须唯一。</p>
<h3 id="labelslabelkey-and-labelvalue"><code>labels</code>，<code>label.Key</code> and <code>label.Value</code></h3>
<p>参数<code>labels</code>是一个键值对数组，引擎通过此键值对数组来选择节点组。
其中，<code>label.Key</code> 和 <code>label.Value</code> 是键-值对中的键和值，</p>
<h3 id="dryrun"><code>dryRun</code></h3>
<p>参数<code>dryRun</code>表示仅运行，不对实际环境做任何修改。该值为<code>false</code>时，可呗命令行参数的<code>dryRun</code>覆盖。</p>
<h3 id="nodegroupid"><code>nodeGroupId</code></h3>
<p>参数<code>nodeGroupId</code>是节点组在云服务商的节点组ID，云服务商通过此参数来从对应云服务商获取改节点组信息。</p>
<h3 id="enableautoscaling"><code>enableAutoscaling</code></h3>
<p>参数<code>enableAutoscaling</code>指示是否启用自动扩缩容特性，默认为<code>true</code>。</p>
<h3 id="autoscaling"><code>autoscaling</code></h3>
<p>参数<code>autoscaling</code>为自动扩缩容提供相应参数，具体请参见<a href="#%E8%87%AA%E5%8A%A8%E6%89%A9%E7%BC%A9%E5%AE%B9%E9%85%8D%E7%BD%AE">自动扩缩容配置</a></p>
<h3 id="enablevirtualcapacity"><code>enableVirtualCapacity</code></h3>
<p>参数<code>enableVirtualCapacity</code>指示是否启用虚拟容量特性，默认为<code>true</code>。</p>
<h3 id="virtualcapacity"><code>virtualCapacity</code></h3>
<p>参数 <code>virtualCapacity</code>为虚拟容量提供相应参数，具体请参见<a href="#%E8%99%9A%E6%8B%9F%E5%AE%B9%E9%87%8F%E9%85%8D%E7%BD%AE">虚拟容量</a></p>
<h3 id="alicloud"><code>alicloud</code></h3>
<p>参数<code>alicloud</code>为云服务商阿里云提供相应参数，具体请参见<a href="#%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%95%86%E9%85%8D%E7%BD%AE">阿里云服务商配置</a></p>
<h2 id="自动扩缩容配置">自动扩缩容配置</h2>
<p>自动扩缩容配置为节点组自动扩缩容提供相应参数，示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>    <span style="color:#f92672">autoscaling</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">minNodes</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxNodes</span>: <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enableScaleUp</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enableScaleDown</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">scaleUp</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">threshold</span>: <span style="color:#ae81ff">0.70</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scaleOnPodPending</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">silencePeriod</span>: <span style="color:#ae81ff">2m</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">scaleDown</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">threshold</span>: <span style="color:#ae81ff">0.40</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">softDeleteGracePeriod</span>: <span style="color:#ae81ff">1m</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hardDeleteGracePeriod</span>: <span style="color:#ae81ff">10m</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">maxNodeRemovalRate</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">taintEffect</span>: <span style="color:#ae81ff">NoExecute</span>
</span></span></code></pre></div><h3 id="minnodes和maxnodes"><code>minNodes</code>和<code>maxNodes</code></h3>
<p>参数<code>minNodes</code>和<code>maxNodes</code>是节点池大小的最大值和最小值。在进行节点扩缩容时，会保证节点池大小满足最大值和最小值的约束。</p>
<h3 id="enablescaleup"><code>enableScaleUp</code></h3>
<p>参数<code>enableScaleUp</code>指示是否启用扩容，默认为<code>true</code>。</p>
<h3 id="enablescaledown"><code>enableScaleDown</code></h3>
<p>参数<code>enableScaleUp</code>指示是否启用缩容，默认为<code>true</code>。</p>
<h3 id="scaleup"><code>scaleUp</code></h3>
<p>参数<code>scaleUp</code>提供扩容相关参数。</p>
<h3 id="scaleupthreshold"><code>scaleUp.threshold</code></h3>
<p>参数<code>scaleUp.threshold</code>是扩容的阈值，当节点组上所有运行Pod的Request总和与节点组Allocatable总和的比值大于此值时，则执行扩容操作。</p>
<h3 id="scaleupscaleonpodpending"><code>scaleUp.scaleOnPodPending</code></h3>
<p>参数<code>scaleUp.scaleOnPodPending</code>指示当Pod Pending时是否执行扩容，默认值为<code>false</code>。当节点组中所有节点都不满足该节点资源需求时，则执行扩容操作。</p>
<h3 id="scaleupsilenceperiod"><code>scaleUp.silencePeriod</code></h3>
<p>参数<code>silencePeriod</code>是沉默时间，当发生扩容事件后，后续在<code>silencePeriod</code>时间内，不再执行扩容操作。</p>
<h3 id="scaledown"><code>scaleDown</code></h3>
<p>参数 <code>scaleDown</code>提供缩容相关参数。</p>
<h3 id="scaledownthreshold"><code>scaleDown.threshold</code></h3>
<p>参数<code>scaleDown.threshold</code>是扩容的阈值，当节点组上所有运行Pod的Request总和与节点组Allocatable总和的比值小于此值时，则执行缩容操作。</p>
<h3 id="scaledownsoftdeletegraceperiod"><code>scaleDown.softDeleteGracePeriod</code></h3>
<p>参数<code>scaleDown.softDeleteGracePeriod</code>是节点软删除等待时间，在软删除等待时间内，引擎不执行缩容操作。</p>
<h3 id="scaledownharddeletegraceperiod"><code>scaleDown.hardDeleteGracePeriod</code></h3>
<p>参数<code>scaleDown.hardDeleteGracePeriod</code>是节点硬删除等待时间，当在软删除等待时间到硬删除等待时间内，只有当节点上的Pod为空时，才会删除节点。在硬删除等待时间之后，引擎会强制删除节点。</p>
<!-- 
节点是否为空的逻辑请参见 `pkg/k8s` `NodeEmpty()` -->
<h3 id="scaledownmaxnoderemovalrate"><code>scaleDown.maxNodeRemovalRate</code></h3>
<p>参数<code>scaleDown.maxNodeRemovalRate</code>是同时缩容节点的最大值。</p>
<h3 id="scaledowntainteffect"><code>scaleDown.taintEffect</code></h3>
<p>参数<code>scaleDown.taintEffect</code>指缩容时的操作，在执行缩容时，将首先给节点打上<code>taint</code>标签，其值取值范围如下：</p>
<ul>
<li>NoSchedule</li>
<li>NoExecute</li>
<li>PreferNoSchedule</li>
</ul>
<p>具体含义，请参见<a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration">污点和容忍度</a></p>
<h2 id="虚拟容量配置">虚拟容量配置</h2>
<p>虚拟容量配置为虚拟容量提供相应参数。示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>    <span style="color:#f92672">virtualCapacity</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">prometheusAddress</span>: <span style="color:#e6db74">&#34;http://prometheus:9090&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">prometheusWindow</span>: <span style="color:#e6db74">&#34;2m&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">isThanos</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">thanosClusterKey</span>: <span style="color:#ae81ff">cluster</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">thanosClusterValue</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">reservationRatio</span>: <span style="color:#ae81ff">0.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">increaseSilencePeriod</span>: <span style="color:#ae81ff">2m</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">decreaseSilencePeriod</span>: <span style="color:#ae81ff">2m</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">stabilityWindow</span>: <span style="color:#ae81ff">5m</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">tolerance</span>: <span style="color:#ae81ff">0.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpuMaxUsage</span>: <span style="color:#ae81ff">0.7</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxValue</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">minValue</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resourceReservation</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kubeReserved</span>: <span style="color:#ae81ff">200m</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">systemReserved</span>: <span style="color:#ae81ff">200m</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">reservedPercentage</span>: <span style="color:#ae81ff">0.1</span> 
</span></span></code></pre></div><h3 id="prometheusaddress"><code>prometheusAddress</code></h3>
<p>参数 <code>prometheusAddress</code>是当前集群节点Metrics监控的Prometheus地址。</p>
<h3 id="prometheuswindow"><code>prometheusWindow</code></h3>
<p>参数 <code>prometheusWindow</code>是引擎查询prometheus时的时间窗口。</p>
<h3 id="isthanos"><code>isThanos</code></h3>
<p>参数<code>isThanos</code>指参数 <code>prometheusAddress</code>对应的Prometheus地址是否为Thanos，默认为false。当prometheus地址是Thanos时，引擎查询时将附加Thanos相关参数。</p>
<h3 id="thanosclusterkey和thanosclustervalue"><code>thanosClusterKey</code>和<code>thanosClusterValue</code></h3>
<p>参数<code>thanosClusterKey</code>和<code>thanosClusterValue</code>是附加到引擎查询时的参数名和参数值（当参数<code>isThanos</code>为<code>true</code>时）。附加参数<code>thanosClusterKey</code>和<code>thanosClusterValue</code>可提升查询性能。</p>
<h3 id="increasesilenceperiod"><code>increaseSilencePeriod</code></h3>
<p>参数<code>increaseSilencePeriod</code>是节点虚拟容量率增加时的静默时间，当节点虚拟容量率增加时，在静默时间窗口<code>increaseSilencePeriod</code>内，将一直保持此值。</p>
<h3 id="decreasesilenceperiod"><code>decreaseSilencePeriod</code></h3>
<p>参数<code>decreaseSilencePeriod</code>是节点虚拟容量率降低时的静默时间，当节点虚拟容量率降低时，在静默时间窗口<code>decreaseSilencePeriod</code>内，将一直保持此值。</p>
<h3 id="stabilitywindow"><code>stabilityWindow</code></h3>
<p>参数<code>stabilityWindow</code>是稳定性窗口，引擎将在每隔一段时间计算一次虚拟容量率，最终决策时将选择稳定性窗口范围内最低值，避免虚拟容量率变化过大，从而引起虚拟容量变化过快。</p>
<h3 id="tolerance"><code>tolerance</code></h3>
<p>参数<code>tolerance</code>是每次应用虚拟容量率时与上次最大差值，此值可防止节点的Allocatable上升过于迅速。</p>
<h3 id="cpumaxusage"><code>cpuMaxUsage</code></h3>
<p>参数<code>cpuMaxUsage</code>是指当CPU利用率最大值，当节点的CPU利用率大于此值时，将不再调度新的Pod。</p>
<h3 id="maxvalue和minvalue"><code>maxValue</code>和<code>minValue</code></h3>
<p>参数<code>maxValue</code>和<code>minValue</code>是虚拟容量率的最大值和最小值。<code>minValue</code>的默认值为1。</p>
<p>虚拟容量率是节点的<code>Allocatable</code>与节点原始的<code>Allocatable</code>的比值。</p>
<h3 id="resourcereservation"><code>resourceReservation</code></h3>
<p>参数<code>resourceReservation</code>是计算虚拟容量率时预留的资源，参数默认值为空。</p>
<p>当参数默认值为空时，引擎将从节点池的节点中获取节点的KubeletConfiguration，并从KubeletConfiguration获取相应值。</p>
<h3 id="resourcereservationkubereserved和resourcereservationsystemreserved"><code>resourceReservation.kubeReserved</code>和<code>resourceReservation.systemReserved</code></h3>
<p>参数<code>resourceReservation.kubeReserved</code>和<code>resourceReservation.systemReserved</code>分别是为kubelet和系统预留的CPU资源。</p>
<h3 id="resourcereservationreservedpercentage"><code>resourceReservation.reservedPercentage</code></h3>
<p>参数<code>resourceReservation.reservedPercentage</code>是引擎为节点上的Pod运行额外预留的资源。</p>
<h2 id="阿里云服务商配置">阿里云服务商配置</h2>
<p>阿里云服务商配置为云服务商阿里云提供相应参数。示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>    <span style="color:#f92672">alicloud</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">clusterId</span>: <span style="color:#ae81ff">c1234567890</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">lifecycle</span>: <span style="color:#ae81ff">spot</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resourceTagging</span>: <span style="color:#66d9ef">false</span>
</span></span></code></pre></div><h3 id="alicloudclusterid"><code>alicloud.clusterId</code></h3>
<p>参数<code>alicloud.clusterId</code>是阿里云ACK集群的集群ID，一般是通过节点上的标签<code>ack.aliyun.com</code>来标识。例如：</p>
<pre tabindex="0"><code>ack.aliyun.com=c1234567890
</code></pre><p>其中，<code>c1234567890</code>即为集群ID。</p>
<h2 id="aws云服务商配置">AWS云服务商配置</h2>
<p>AWS云服务商配置为云服务商AWS提供相应参数，示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>    <span style="color:#f92672">aws</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">launchTemplateId</span>: <span style="color:#ae81ff">lt-</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">launchTemplateVersion</span>: <span style="color:#ae81ff">spot</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">instanceReadyTimeout</span>: <span style="color:#ae81ff">2m</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resourceTagging</span>: <span style="color:#66d9ef">false</span>
</span></span></code></pre></div><h3 id="awslaunchtemplateid和awslaunchtemplateversion"><code>aws.launchTemplateId</code>和<code>aws.launchTemplateVersion</code></h3>
<p>参数<code>aws.launchTemplateId</code>和<code>aws.launchTemplateVersion</code>分别是AWS启动模板ID和模板版本值，用于配置扩容过程中的启动模板。</p>
<p>通过此参数，引擎可以使用AWS Fleet API来一次性将节点池扩容到期望的容量。</p>
<p>参数<code>aws.launchTemplateId</code>和<code>aws.launchTemplateVersion</code>的值可通过两种途径获取：</p>
<ul>
<li>通过AWS EC2控制台中的启动模板页面获取。</li>
<li>通过<a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/create-launch-template.html">创建启动模板</a>中的CLI命令
或者AWS API中返回中的<code>LatestVersionNumber</code>或者<code>DefaultVersionNumber</code>中获取。</li>
</ul>
<h3 id="awsinstancereadytimeout"><code>aws.instanceReadyTimeout</code></h3>
<p>参数<code>aws.instanceReadyTimeout</code>是使用AWS Fleet API来一次性将节点池扩容时等待EC2实例就绪的超时时间。</p>
<p>此参数是可选参数，默认值为1分钟。</p>
<!-- This is an optional field. The default value is 1 minute.

When using the one-shot capacity acquisition for AWS (see `aws.launch_template_id`), this is the maximum amount of time
that Escalator will block waiting for new EC2 instances to become ready so that they can be added to the node group.
This roughly corresponds to the amount of time it takes an instance to boot to multi-user mode and for the EC2 control
plane to notice that it is healthy. This generally takes much less than a minute.

**Note:** Escalator will block other scaling operations for, at most, this amount of time while new capacity comes
online. -->
<h3 id="awslifecyle"><code>aws.lifecyle</code></h3>
<p>参数<code>aws.lifecyle</code>指定实例的生命周期，其取值为<code>on-demand</code>或者<code>spot</code>或者<code>on-demand,spot</code>。</p>
<p>此参数为可选参数，默认值为<code>on-demand</code>。</p>
<p><code>on-demand</code>指示引擎扩容时使用按需实例，<code>spot</code>指示引擎扩容时使用竞价实例。</p>
<h3 id="awsinstancetypeoverrides"><code>aws.instanceTypeOverrides</code></h3>
<p>参数<code>aws.lifecyle</code>指定实例的类型。此参数为可选参数，无默认值。</p>
<p>引擎创建扩容请求时可以使用参数<code>aws.lifecyle</code>指定的多个实例类型，从而增加扩容的成功几率。</p>
<h3 id="awsresourcetagging"><code>aws.resourceTagging</code></h3>
<p>参数<code>aws.resourceTagging</code>指示是否给引擎管理的节点打上资源标签<code>autoscaling.wiseinf.com\enabled</code>:<code>true</code>。</p>
<p>该标签不影响引擎任何功能，主要是便于利用标签对EC2实例进行管理。具体请参考<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html">使用标签</a>。</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-743cd90d3c1ba1709b66bd0042c39a58">3.4.2 - 命令行参数</h1>
    <div class="lead">描述了Ruyi：云原生集群扩缩容引擎的命令行参数。</div>
	

<div class="pageinfo pageinfo-primary">
<p>Ruyi：云原生集群扩缩容引擎。</p>

</div>

<h2 id="命令行参数">命令行参数</h2>
<p>通过 <code>--help</code> 可以获取Ruyi引擎的用法，如下：</p>
<pre tabindex="0"><code>$ruyi --help
usage: ruyi --config=CONFIG [&lt;flags&gt;]

Flags:
      --help                     Show context-sensitive help (also try --help-long and --help-man).
  -f, --features=&#34;Autoscaling,VirtualCapacity&#34;  
                                 Enable ruyi features. Available options are Autoscaling, VirtualCapacity
      --cloud-provider=aws       Set cloud provider to use. Available options are (aws, alicloud)
      --config=CONFIG            Set config file location
      --kubeconfig=KUBECONFIG    Set kubeconfig file location
      --interval=60s             Set interval for evaluating node scale up or down
      --metrics-address=&#34;:8080&#34;  Set address for /metrics
      --health-probe-address=&#34;:8090&#34;  
                                 Set address for health probe
      --port=8443                Set port
      --dry-run                  Set dry-run argument. If true, forces dry run on all nodegroups
  -v, --loglevel=info            Set logging level. Available options are (trace, debug, info, warning, error, fatal, panic)
      --logfmt=text              Set logging format. Available options are (text, json)
      --enable-virtual-capacity-controller  
                                 Set enable virtual capacity controller
      --enable-webhook           Set enable webhook for virtual capacity
      --webhook-cert-dir=&#34;&#34;      Set webhook certificate directory
      --concurrency=5            Set concurrency
      --leader-elect             Enable leader election
      --leader-elect-lease-duration=15s  
                                 Set leader election lease duration
      --leader-elect-renew-deadline=10s  
                                 Set leader election renew deadline
      --leader-elect-retry-period=2s  
                                 Set leader election retry period
      --leader-elect-lease-namespace=&#34;wiseinf-system&#34;  
                                 Set leader election lease object namespace
      --leader-elect-lease-name=&#34;ruyi-lease&#34;  
                                 Set leader election lease object name
</code></pre><p>下面将对参数进行详细描述。</p>
<h2 id="参数描述">参数描述</h2>
<h3 id="--help"><code>--help</code></h3>
<p>参数<code>--help</code>提供命令行的用法帮助。</p>
<h3 id="-f---features"><code>-f, --features</code></h3>
<p>参数 <code>-f, --features</code>指示引擎启动的特性，其中<code>Autoscaling</code>表示启用自动扩缩容特性，<code>VirtualCapacity</code>表示启动虚拟容量特性。</p>
<p>默认值为<code>Autoscaling,VirtualCapacity</code>，表示同时启用自动扩缩容特性和虚拟容量特性。</p>
<h3 id="--cloud-provider"><code>--cloud-provider</code></h3>
<p>参数<code>--cloud-provider</code>指示引擎所使用的云服务提供商。其取值为aws或者alicloud，默认值为aws。</p>
<h3 id="--config"><code>--config</code></h3>
<p>参数<code>--config</code>指示引擎所使用的节点组配置文件位置。节点组配置请参见<a href="/docs/ruyi/configuration/nodegroup">节点组配置</a></p>
<h3 id="--kubeconfig"><code>--kubeconfig</code></h3>
<p>参数<code>--kubeconfig</code>指示引擎所使用的kubeconfig文件位置。默认为空，此时将使用集群内访问配置。</p>
<h3 id="--interval"><code>--interval</code></h3>
<p>参数<code>--interval</code>指示引擎中功能特性所使用的调度间隔。比如，自动扩缩容每间隔此时间就评估节点池是扩容还是缩容。</p>
<p>此默认值为60秒。</p>
<h3 id="--metrics-address"><code>--metrics-address</code></h3>
<p>参数<code>--metrics-address</code>指示引擎所使用的监控指标的端口，可从此端口的<code>/metrics</code>获取具体的指标数据。</p>
<h3 id="--health-probe-address"><code>--health-probe-address</code></h3>
<p>参数<code>--health-probe-address</code>指示引擎所使用的监控探测地址，可从此端口的<code>/healthz</code>和<code>/readyz</code>分别进行健康探测和就绪探测。</p>
<h3 id="--port"><code>--port</code></h3>
<p>参数<code>--port</code>是引擎Webhook所使用的端口，默认值是8443.</p>
<h3 id="--dry-run"><code>--dry-run</code></h3>
<p>参数<code>--dry-run</code>指示引擎仅运行，不对环境、节点做任何修改。</p>
<h3 id="-v---loglevelinfo"><code>-v, --loglevel=info</code></h3>
<p>参数<code>--dry-run</code>设置日志级别。可选值包括<code>trace</code>, <code>debug</code>, <code>info</code>, <code>warning</code>, <code>error</code>, <code>fatal</code>, <code>panic</code>，默认值为<code>info</code>。</p>
<h3 id="--logfmt"><code>--logfmt</code></h3>
<p>参数<code>--dry-run</code>设置日志输出格式。可选值包括<code>text</code>, <code>json</code>，默认值为<code>text</code>，表示输出位文本格式。</p>
<h3 id="--enable-virtual-capacity-controller"><code>--enable-virtual-capacity-controller</code></h3>
<p>参数<code>--enable-virtual-capacity-controller</code>表示是否启用虚拟容量控制器，默认值为<code>true</code>。</p>
<h3 id="--enable-webhook"><code>--enable-webhook</code></h3>
<p>参数<code>--enable-webhook</code>表示是否启用Webhook，默认值为<code>true</code>。</p>
<h3 id="--webhook-cert-dir"><code>--webhook-cert-dir</code></h3>
<p>参数<code>--webhook-cert-dir</code>标明启用Webhook时证书的目录位置。引擎将通过此目录位置下的文件<code>tls.crt</code>和<code>tls.key</code>来初始化Webhook的证书。
若其值为空，则Webhook将在目录<code>/tmp/k8s-webhook-server/serving-certs</code>中查找证书</p>
<!-- ### `--concurrency`

参数`--concurrency`指示并发数。默认值为5，暂未使用。 -->
<h3 id="--leader-elect"><code>--leader-elect</code></h3>
<p>参数<code>--leader-elect</code>设置是否启用选主机制。一般在高可用环境下使用。</p>
<h3 id="leader-elect-lease-duration"><code>leader-elect-lease-duration</code></h3>
<p>参数 <code>leader-elect-lease-duration</code>设置非主节点获取选主租约的等待时间。默认值为15秒。</p>
<h3 id="--leader-elect-renew-deadline"><code>--leader-elect-renew-deadline</code></h3>
<p>参数<code>--leader-elect-renew-deadline</code>设置主节点更新租约的超时时间。默认值为10秒。</p>
<h3 id="--leader-elect-retry-period"><code>--leader-elect-retry-period</code></h3>
<p>参数<code>--leader-elect-renew-deadline</code>设置节点重试时的等待时间。默认值为2秒。</p>
<h3 id="--leader-elect-lease-namespace"><code>--leader-elect-lease-namespace</code></h3>
<p>参数<code>--leader-elect-lease-namespace</code>设置存储租约的名称空间。默认值为<code>wiseinf-system</code>.</p>
<h3 id="--leader-elect-lease-name"><code>--leader-elect-lease-name</code></h3>
<p>参数<code>--leader-elect-lease-name</code>设置租约的名称。默认值为<code>ruyi-lease</code>.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-db1b774ac87b4e433a86ed299f8a808f">3.5 - 监控</h1>
    <div class="lead">描述了Ruyi：云原生扩缩容引擎相关的监控机制</div>
	

<div class="pageinfo pageinfo-primary">
<p>Ruyi：云原生集群扩缩容引擎监控。</p>

</div>

<h2 id="监控">监控</h2>
<p>云原生扩缩容引擎提供了一些列的监控指标，支持通过Prometheus/Thanos对其进行监控。</p>
<h3 id="自动扩缩容指标">自动扩缩容指标</h3>
<table>
<thead>
<tr>
<th>指标名称</th>
<th>标签</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ruyi_autoscaling_run_count</td>
<td>无</td>
<td>自动扩缩容运行次数</td>
</tr>
<tr>
<td>ruyi_nodegroup_nodes</td>
<td>nodegroup: 节点组名称<br/>type: 节点类型</td>
<td>节点组各类型节点数量</td>
</tr>
<tr>
<td>ruyi_nodegroup_pods</td>
<td>nodegroup: 节点组名称</td>
<td>节点组各类型Pod数量</td>
</tr>
<tr>
<td>ruyi_nodegroup_request</td>
<td>nodegroup: 节点组名称<br/> resource: 资源类型</td>
<td>节点组请求量</td>
</tr>
<tr>
<td>ruyi_nodegroup_capacity</td>
<td>nodegroup: 节点组名称<br/> resource: 资源类型</td>
<td>节点组容量</td>
</tr>
<tr>
<td>ruyi_nodegroup_percent</td>
<td>nodegroup: 节点组名称<br/> resource: 资源类型</td>
<td>节点组请求量百分比</td>
</tr>
<tr>
<td>ruyi_nodegroup_scale_delta</td>
<td>nodegroup: 节点组名称</td>
<td>节点组节点调整量</td>
</tr>
<tr>
<td>ruyi_nodegroup_size</td>
<td>nodegroup: 节点组名称<br/> id: 节点组ID <br/> cloud_provider: 云服务商 <br/> type: 类型</td>
<td>节点组大小</td>
</tr>
</tbody>
</table>
<h3 id="虚拟容量指标">虚拟容量指标</h3>
<table>
<thead>
<tr>
<th>指标名称</th>
<th>标签</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ruyi_virtual_capacity_run_count</td>
<td></td>
<td>虚拟容量运行次数</td>
</tr>
<tr>
<td>ruyi_node_request_sum</td>
<td>node: 节点名称<br/> id: 节点组ID <br/> nodegroup: 节点组名称<br/> resource: 资源类型</td>
<td>节点请求量</td>
</tr>
<tr>
<td>ruyi_node_allocatable</td>
<td>node: 节点名称<br/> id: 节点组ID <br/> nodegroup: 节点组名称<br/> resource: 资源类型</td>
<td>节点虚拟容量Allocatable</td>
</tr>
<tr>
<td>ruyi_virtual_capacity_ratio</td>
<td>node: 节点名称<br/> id: 节点组ID <br/> nodegroup: 节点组名称<br/>  type：类型</td>
<td>虚拟容量率</td>
</tr>
</tbody>
</table>
<p>另外，用户也可以通过Kubernetes的指标<code>kube_node_status_allocatable</code>查看实际虚拟容量的变化情况。</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-583a7f09d0feaa261a5b4bd84a75d62a">3.6 - 常见问题</h1>
    <div class="lead">使用Ruyi：云原生集群扩缩容引擎的常见问题及排查流程。</div>
	

<div class="pageinfo pageinfo-primary">
<p>使用Ruyi：云原生集群扩缩容引擎的常见问题及排查流程。</p>

</div>

<p>正在更新中，请稍后。</p>
<!-- ## 问题1：

## 问题2：

## 问题3： -->
</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="帮助和支持" aria-label="帮助和支持">
    <a class="text-white" target="_blank" rel="noopener" href="mailto:help@wiseinf.com?subject=%e5%b8%ae%e5%8a%a9%e5%92%8c%e6%94%af%e6%8c%81" aria-label="帮助和支持">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="商务合作" aria-label="商务合作">
    <a class="text-white" target="_blank" rel="noopener" href="mailto:business@wiseinf.com?subject=%e5%95%86%e5%8a%a1%e5%90%88%e4%bd%9c" aria-label="商务合作">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="网站源码" aria-label="网站源码">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/wiseinf/wiseinf.github.io" aria-label="网站源码">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2024 北京云智优本科技有限公司 保留所有权利</small>
        
        <p><small class="ms-1"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">京ICP备2023011485号</a></small>
        <small class="ms-1"><a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802042031" target="_blank" rel="noopener">京公安网备11010802042031号</a></small></p>
	
		<p class="mt-2"><a href="/zh-cn/about/">关于我们</a></p>
	
      </div>
    </div>
  </div>
</footer>

    </div>
    
<script src="/local/cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="/local/stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>











<script src="/js/main.min.604e1b596f799449dffc6f056b597a5d8c1bfedb73f2844175ff85802887b69d.js" integrity="sha256-YE4bWW95lEnf/G8Fa1l6XYwb/ttz8oRBdf&#43;FgCiHtp0=" crossorigin="anonymous"></script>




  </body>
</html>
